



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="Sunday" href="http://hexlove2.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="Sunday" href="http://hexlove2.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="Sunday" href="http://hexlove2.github.io/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="Socket,TCP/IP,Github" />


<link rel="canonical" href="http://hexlove2.github.io/2024/07/01/Projects/ChatWeb/">



  <title>
ChatWeb Project - Projects |
Hex = Sunday = Later's better than never</title>
<meta name="generator" content="Hexo 6.3.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">ChatWeb Project
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2024-07-02 00:00:00">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2024-07-02T00:00:00+09:00">2024-07-02</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Hex</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://raw.githubusercontent.com/Hexlove2/images1/main/images2/17.jpg"></li>
          <li class="item" data-background-image="https://raw.githubusercontent.com/Hexlove2/images1/main/images2/15.jpg"></li>
          <li class="item" data-background-image="https://raw.githubusercontent.com/Hexlove2/images1/main/images2/25.jpg"></li>
          <li class="item" data-background-image="https://raw.githubusercontent.com/Hexlove2/images1/main/images2/10.jpg"></li>
          <li class="item" data-background-image="https://raw.githubusercontent.com/Hexlove2/images1/main/images2/5.jpg"></li>
          <li class="item" data-background-image="https://raw.githubusercontent.com/Hexlove2/images1/main/images2/8.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span><i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Projects/" itemprop="item" rel="index" title="In Projects"><span itemprop="name">Projects</span></a>
<meta itemprop="position" content="1" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="http://hexlove2.github.io/2024/07/01/Projects/ChatWeb/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="Sunday">
    <meta itemprop="description" content="Later's better than never, Later's better than never">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Sunday">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="chatweb-project-notes"><a class="markdownIt-Anchor" href="#chatweb-project-notes">#</a> ChatWeb project notes</h1>
<h2 id="abstract"><a class="markdownIt-Anchor" href="#abstract">#</a> Abstract:</h2>
<p>**This page allows users to create an account and log in. Upon logging in, users enter a chat room where they can interact with other participants. Users can view the usernames and messages sent by others in real-time **</p>
<h2 id="1-front-end"><a class="markdownIt-Anchor" href="#1-front-end">#</a> 1. Front-End</h2>
<p><img data-src="https://raw.githubusercontent.com/Hexlove2/images1/main/images/Screenshot%202024-07-07%20at%202.00.41%E2%80%AFPM.png" alt="Screenshot 2024-07-07 at 2.00.41 PM"></p>
<h3 id="1-vue"><a class="markdownIt-Anchor" href="#1-vue">#</a> 1. Vue</h3>
<p><strong>Note: The version of vue here I use is vue3.</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">vue create chatwebfront
<span class="token function">npm</span> <span class="token function">install</span> //modeules you need
<span class="token function">npm</span> run server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="1set-your-page"><a class="markdownIt-Anchor" href="#1set-your-page">#</a> 1.Set your page</h4>
<p>First, you need to plan the entire structure of the website’s client side, including the layout of your home page. That’s why we need vue router. It controls page navigation and display. Here is my router setup.</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createRouter<span class="token punctuation">,</span> createWebHistory <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span>
<span class="token keyword">import</span> HomePage <span class="token keyword">from</span> <span class="token string">'../components/HomePage.vue'</span>
<span class="token keyword">import</span> ChatRoom <span class="token keyword">from</span> <span class="token string">'../components/ChatRoom.vue'</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'HomePage'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> HomePage <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>   <span class="token comment">// 默认打开 HomePage 组件</span>
  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/chatroom/:username'</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ChatRoom'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> ChatRoom <span class="token punctuation">,</span><span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span> <span class="token comment">// ChatRoom 路径指向 ChatRoom 组件</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">history</span><span class="token operator">:</span> <span class="token function">createWebHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  routes
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Remember to import it in main.js too.</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createApp <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span><span class="token punctuation">;</span>

<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2-coding-about-the-home-page"><a class="markdownIt-Anchor" href="#2-coding-about-the-home-page">#</a> 2. Coding about the home page.</h4>
<p>Ok, before I show the code, let’s see what it looks like.</p>
<p><img data-src="https://raw.githubusercontent.com/Hexlove2/images1/main/images/Screenshot%202024-07-07%20at%202.31.00%E2%80%AFPM.png" alt="Screenshot 2024-07-07 at 2.31.00 PM"></p>
<p><img data-src="https://raw.githubusercontent.com/Hexlove2/images1/main/images/Screenshot%202024-07-07%20at%202.43.52%E2%80%AFPM.png" alt="Screenshot 2024-07-07 at 2.43.52 PM"></p>
<p>I don’t want to focus too much on how to design the page to make it look nice, the point is how it works, so I’ll skip the CSS part.</p>
<p>Let’s start with the register part. Input your username and password, then click the sign-up button. Obviously, the server needs to send your information to the back-end server called the HTTP server, here is the html part below.</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>  <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Username<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>registerForm.username<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Password<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>registerForm.password<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>E-Mail<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>registerForm.email<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>send_code<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Send Verification code<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>VERIFICATION CODE<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>registerForm.code<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Sign Up<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>The v-model directive in Vue.js is used to create a two-way data binding on form inputs, textareas, and select elements. It ensures that the data in the Vue instance stays in sync with the input elements in the DOM. When the user updates the input, the bound data is automatically updated, and vice versa.</p>
<p>So, here is the js parts</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//data  </span>
<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'HomePage'</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">loginForm</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">''</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">registerForm</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token string">''</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//add click event </span>
<span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span> signInButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#signIn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span> signUpButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#signUp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   signUpButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> container<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'right-panel-active'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   signInButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> container<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'right-panel-active'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">   <span class="token comment">//try to register</span>
<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
     <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://192.168.31.137:9176/register'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
       <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
       <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
         <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
       <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
       <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>registerForm<span class="token punctuation">)</span>
     <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
             document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'register_username'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> result<span class="token punctuation">.</span>message<span class="token punctuation">;</span>
             document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'register_username'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'pink'</span><span class="token punctuation">;</span> <span class="token comment">// 可选：改变文字颜色</span>

     <span class="token comment">// 处理后端响应</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>status<span class="token operator">===</span><span class="token string">'success'</span><span class="token punctuation">)</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showRegisterText</span><span class="token punctuation">(</span><span class="token string">'Register Success!'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'注册失败:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showRegisterText</span><span class="token punctuation">(</span><span class="token string">'Register Failed'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>You can see that I used the fetch function to send the message in json format, It’s a POST HTTP request. Then I can receive the message from the HTTP server if everything about NET was okay. The status of the result should be success.</p>
<p>The part about how back-end handles this request will be shown in the back-end section below.</p>
<p>Here is the login part.</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'waiting0...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://192.168.31.137:9176/login'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>loginForm<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 打印响应的状态码和内容类型</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'响应状态码:'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'响应内容类型:'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 检查响应内容</span>

    <span class="token comment">// 将响应文本解析为JSON</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token comment">// 更新并显示错误消息</span>
            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'loginresult'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> result<span class="token punctuation">.</span>message<span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>status<span class="token operator">===</span><span class="token string">'error'</span><span class="token punctuation">)</span>
              document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'loginresult'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span> <span class="token comment">// 可选：改变文字颜色</span>
            <span class="token keyword">else</span>
              document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'loginresult'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'blue'</span><span class="token punctuation">;</span> <span class="token comment">// 可选：改变文字颜色</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showRegisterText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'success'</span><span class="token punctuation">)</span>
      <span class="token comment">// 假设在登录成功后的处理函数中</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ChatRoom'</span><span class="token punctuation">,</span> <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loginForm<span class="token punctuation">.</span>username <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'登录失败:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showLoginErrorText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>If the back-end responds with a success message, the router will navigate to another page: the Chat room.</p>
<h4 id="3-coding-about-the-chat-room"><a class="markdownIt-Anchor" href="#3-coding-about-the-chat-room">#</a> 3. Coding about the chat room</h4>
<p>The chat room looks like this.</p>
<img data-src="https://raw.githubusercontent.com/Hexlove2/images1/main/images/Screenshot%202024-07-07%20at%203.21.49%E2%80%AFPM.png" width="500">
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chat-container-chatroom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Welcome to the Chat Room<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>video-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>localVideo<span class="token punctuation">"</span></span> <span class="token attr-name">autoplay</span> <span class="token attr-name">muted</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>remoteVideo<span class="token punctuation">"</span></span> <span class="token attr-name">autoplay</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>messages-chatroom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(message, index) in messages<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username-chatroom<span class="token punctuation">"</span></span> <span class="token attr-name">v-html</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message.username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message-content-chatroom<span class="token punctuation">"</span></span> <span class="token attr-name">v-html</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message.content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-container-chatroom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>newMessage<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Type your message here...<span class="token punctuation">"</span></span> <span class="token attr-name">@keypress.enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sendMessage<span class="token punctuation">"</span></span> <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleInput<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sendMessage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Send<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>video-buttons<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>videostart<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>startVideo<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>StartVideo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>videohangup<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stopVideo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Hangup<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Okay, the point is, how does the server send each message to every client in this room?</p>
<p>If you want to transfer messages between a server and a web-based client, it’s convenient to use WebSocket, but how? Well, the good news is it’s easy to use it on the Front-End.</p>
<p>First, you need to connect to the server in advance, send a HTTP request to upgrade the protocol from http to websocket. So you can code like this.</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">created()&#123;
  this.connectWebSocket();
  window.addEventListener(&#39;beforeunload&#39;, function () &#123;
  if (this.socket &amp;&amp; this.socket.readyState &#x3D;&#x3D;&#x3D; WebSocket.OPEN) &#123;
      this.socket.close();
  &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">connectWebSocket()&#123;
  this.socket &#x3D; new WebSocket(&#39;ws:&#x2F;&#x2F;192.168.31.137:7777&#39;);

  this.socket.onopen &#x3D; () &#x3D;&gt; &#123;
      console.log(&#39;WebSocket connection opened&#39;);
      &#x2F;&#x2F;this.socket.send(&#39;Hello!&#39;);
      console.log(&#39;已发送hello消息&#39;);
  &#125;;
  this.socket.onmessage &#x3D; (event) &#x3D;&gt;&#123;
   		const data&#x3D; JSON.parse(event.data);      
      this.messages.push(data);
      this.$nextTick(()&#x3D;&gt;&#123;
        this.scrollToBottom();
      &#125;);
    &#125;;        
  &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>You’ll send a POST request to server when you use WebSocket. The server will then understand that it’s a handshake request and send the correct response back.</p>
<p>Now that the protocol has upgraded to websocket, it’s time to communicate with each end.</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">  <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>newMessage<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;span style="color: blue;">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>username<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">]&lt;/span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>newMessage<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Trim whitespace properly</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Prepared message to send:'</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Log the message</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span>readyState <span class="token operator">===</span> WebSocket<span class="token punctuation">.</span><span class="token constant">OPEN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> jsonMessage <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'JSON message to send:'</span><span class="token punctuation">,</span> jsonMessage<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Log the JSON message</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>jsonMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message sent:'</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Failed to send message:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'WebSocket is not open. Ready state is:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>newMessage <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">scrollToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'New message is empty or only whitespace'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Log if newMessage is empty or whitespace</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="2-webrtc"><a class="markdownIt-Anchor" href="#2-webrtc">#</a> 2. Webrtc</h3>
<p>To be continued.</p>
<h2 id="2-back-end"><a class="markdownIt-Anchor" href="#2-back-end">#</a> 2. Back-End</h2>
<h3 id="1-http-server"><a class="markdownIt-Anchor" href="#1-http-server">#</a> 1. HTTP Server</h3>
<h4 id="1-preprocessor"><a class="markdownIt-Anchor" href="#1-preprocessor">#</a> 1. Preprocessor</h4>
<p>The Http server is used to receive http request and response correctly, for example, it can check if the username and password provided by the POST request match the records in the mysql database.</p>
<p>The server I developed uses multiple threads to handle each client who connects to the server. (It’s not ideal, as I should use a thread pool instead of creating a new thread for each client)</p>
<p>Here is the main function and other functions.</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"mysql.c"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUF_SIZE</span> <span class="token expression"><span class="token number">1024</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SMALL_BUF</span> <span class="token expression"><span class="token number">1024</span></span></span>

<span class="token keyword">void</span> <span class="token function">handle_request</span><span class="token punctuation">(</span><span class="token keyword">int</span> client_sock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">error_handling</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">send_response</span><span class="token punctuation">(</span><span class="token keyword">int</span> clnt_sock<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">extract_value</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>value<span class="token punctuation">,</span> <span class="token class-name">size_t</span> value_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
bool <span class="token function">login_request</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>body<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> sock<span class="token punctuation">)</span><span class="token punctuation">;</span>
bool <span class="token function">register_request</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>body<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> sock<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> serv_sock<span class="token punctuation">,</span> clnt_sock<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> serv_adr<span class="token punctuation">,</span> clnt_adr<span class="token punctuation">;</span>
    <span class="token class-name">socklen_t</span> clnt_adr_sz<span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>argc<span class="token operator">!=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Usage: %s &lt;port>\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    serv_sock<span class="token operator">=</span><span class="token function">socket</span><span class="token punctuation">(</span>PF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>serv_sock <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token function">error_handling</span><span class="token punctuation">(</span><span class="token string">"socket() error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>serv_adr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>serv_adr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    serv_adr<span class="token punctuation">.</span>sin_family<span class="token operator">=</span>AF_INET<span class="token punctuation">;</span>
    serv_adr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr<span class="token operator">=</span><span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    serv_adr<span class="token punctuation">.</span>sin_port<span class="token operator">=</span><span class="token function">htons</span><span class="token punctuation">(</span><span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>serv_sock<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>serv_adr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>serv_adr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token function">error_handling</span><span class="token punctuation">(</span><span class="token string">"bind() error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">listen</span><span class="token punctuation">(</span>serv_sock<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token function">error_handling</span><span class="token punctuation">(</span><span class="token string">"listen() error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        clnt_adr_sz<span class="token operator">=</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>clnt_adr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        clnt_sock<span class="token operator">=</span><span class="token function">accept</span><span class="token punctuation">(</span>serv_sock<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>clnt_adr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>clnt_adr_sz<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>clnt_sock<span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token function">error_handling</span><span class="token punctuation">(</span><span class="token string">"accept() error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">handle_request</span><span class="token punctuation">(</span>clnt_sock<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">close</span><span class="token punctuation">(</span>clnt_sock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">close</span><span class="token punctuation">(</span>serv_sock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Now let’s see how the handle_request function works.</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">handle_request</span><span class="token punctuation">(</span><span class="token keyword">int</span> clnt_sock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span> req_line<span class="token punctuation">[</span>SMALL_BUF<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> method<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> content_length<span class="token punctuation">[</span>SMALL_BUF<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> content_type<span class="token punctuation">[</span>SMALL_BUF<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> header<span class="token punctuation">[</span>SMALL_BUF<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> str_len<span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Reading the request line</span>
    <span class="token keyword">int</span> idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">char</span> c<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>clnt_sock<span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        req_line<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    req_line<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// Parsing the HTTP method from the request line</span>
    <span class="token function">sscanf</span><span class="token punctuation">(</span>req_line<span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"********************************************************************* \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>req_line<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"********************************************************************* \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Handling the OPTIONS request (preflight request for CORS)</span>
  	<span class="token comment">// Beacuse the request sent by front end is json type</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> <span class="token string">"OPTIONS"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">char</span> response<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
            <span class="token string">"HTTP/1.1 204 No Content\r\n"</span>
            <span class="token string">"Access-Control-Allow-Origin: *\r\n"</span>
            <span class="token string">"Access-Control-Allow-Methods: POST, GET, OPTIONS\r\n"</span>
            <span class="token string">"Access-Control-Allow-Headers: Content-Type\r\n"</span>
            <span class="token string">"\r\n"</span><span class="token punctuation">;</span>
        <span class="token function">write</span><span class="token punctuation">(</span>clnt_sock<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"CORS SUCCESS \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// Handling only POST requests</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">send_response</span><span class="token punctuation">(</span>clnt_sock<span class="token punctuation">,</span> <span class="token string">"HTTP/1.1 405 Method Not Allowed\r\n\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 逐行读取请求头</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">char</span> c<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>clnt_sock<span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            header<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        header<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span> <span class="token string">"\r\n"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Header: %s"</span><span class="token punctuation">,</span> header<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span> <span class="token string">"Content-Length"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token function">sscanf</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span> <span class="token string">"Content-Length: %d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">send_response</span><span class="token punctuation">(</span>clnt_sock<span class="token punctuation">,</span> <span class="token string">"HTTP/1.1 411 Length Required\r\n\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// Reading the body based on Content-Length</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>body <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>body <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">send_response</span><span class="token punctuation">(</span>clnt_sock<span class="token punctuation">,</span> <span class="token string">"HTTP/1.1 500 Internal Server Error\r\n\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">int</span> total_read <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>total_read <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        n <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>clnt_sock<span class="token punctuation">,</span> body <span class="token operator">+</span> total_read<span class="token punctuation">,</span> length <span class="token operator">-</span> total_read<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
        total_read <span class="token operator">+=</span> n<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    body<span class="token punctuation">[</span>total_read<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Received Body: %s\n"</span><span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Process the received data (e.g., parse JSON, handle login logic, etc.)</span>
    <span class="token comment">// Placeholder for JSON parsing and login logic</span>

    <span class="token comment">//login request</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span>req_line<span class="token punctuation">,</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">login_request</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span>clnt_sock<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Login success \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
     <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//register request</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span>req_line<span class="token punctuation">,</span><span class="token string">"register"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">register_request</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span>clnt_sock<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"register success\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Ending............................................................\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//fflush(stdout);</span>
    <span class="token comment">// Sending the response</span>
    <span class="token comment">// Free the allocated memory for the body</span>
    <span class="token function">free</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Here is the output of the back-end terminal.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">********************************************************************* 
OPTIONS /login HTTP/1.1
********************************************************************* 
CORS SUCCESS 


********************************************************************* 
POST /login HTTP/1.1
********************************************************************* 
Header: Host: <span class="token number">192.168</span>.31.137:9176
Header: Content-Type: application/json
Header: Origin: http://localhost:8080
Header: Accept-Encoding: gzip, deflate
Header: Connection: keep-alive
Header: Accept: */*
Header: User-Agent: Mozilla/5.0 <span class="token punctuation">(</span>Macintosh<span class="token punctuation">;</span> Intel Mac OS X 10_15_7<span class="token punctuation">)</span> AppleWebKit/605.1.15 <span class="token punctuation">(</span>KHTML, like Gecko<span class="token punctuation">)</span> Version/17.4.1 Safari/605.1.15
Header: Referer: http://localhost:8080/
Header: Content-Length: <span class="token number">41</span>
Header: Accept-Language: en-US,en<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>
Received Body: <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token builtin class-name">:</span><span class="token string">"Sunday"</span>,<span class="token string">"password"</span><span class="token builtin class-name">:</span><span class="token string">"123456"</span><span class="token punctuation">&#125;</span>
Body内容:<span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token builtin class-name">:</span><span class="token string">"Sunday"</span>,<span class="token string">"password"</span><span class="token builtin class-name">:</span><span class="token string">"123456"</span><span class="token punctuation">&#125;</span> 
Username: Sunday
Password: <span class="token number">123456</span>
password from Web:123456
password from Mysql:123456
check successed
login success 
Login success 
Ending<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>So we got the username and password, how to check them in MYSQL?</p>
<h4 id="2-usage-of-mysql"><a class="markdownIt-Anchor" href="#2-usage-of-mysql">#</a> 2. Usage of MySql</h4>
<p>Here are three functions created in mysql.c.</p>
<p>You need to know some mysql statements to understand these funcs.</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">bool <span class="token function">user_search</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
bool <span class="token function">password_check</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>username<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
bool <span class="token function">register_mysql</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>username<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>The first one is user search.</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mysql/mysql.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h></span></span>

<span class="token comment">// 函数声明：user_search，用于在数据库中查找用户名</span>
bool <span class="token function">user_search</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>username<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>   
    MYSQL <span class="token operator">*</span>conn<span class="token punctuation">;</span>      <span class="token comment">// MySQL 连接句柄</span>
    MYSQL_RES <span class="token operator">*</span>res<span class="token punctuation">;</span>   <span class="token comment">// 查询结果集</span>
    MYSQL_ROW row<span class="token punctuation">;</span>    <span class="token comment">// 行数据</span>
    
    <span class="token keyword">char</span> query<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 存储 SQL 查询的字符串</span>
    <span class="token comment">// 使用 snprintf 函数格式化查询字符串，将输入的用户名嵌入到查询中</span>
    <span class="token function">snprintf</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"SELECT username FROM clients WHERE username='%s'"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>

    conn <span class="token operator">=</span> <span class="token function">mysql_init</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 初始化 MySQL 连接句柄</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>conn <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 检查初始化是否成功</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"mysql_init() failed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>  <span class="token comment">// 如果初始化失败，返回 false</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 连接到 MySQL 数据库，指定主机名、用户名、密码、数据库名和端口号</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mysql_real_connect</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token string">"chat"</span><span class="token punctuation">,</span> <span class="token string">"123456"</span><span class="token punctuation">,</span> <span class="token string">"ChatClient"</span><span class="token punctuation">,</span> <span class="token number">3306</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"mysql_real_connect() failed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">mysql_close</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 关闭 MySQL 连接</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>  <span class="token comment">// 如果连接失败，返回 false</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 执行查询，检查查询是否成功</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mysql_query</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> query<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"SELECT error: %s\n"</span><span class="token punctuation">,</span> <span class="token function">mysql_error</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">mysql_close</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 关闭 MySQL 连接</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>  <span class="token comment">// 如果查询失败，返回 false</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 存储查询结果</span>
    res <span class="token operator">=</span> <span class="token function">mysql_store_result</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 检查结果是否成功存储</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"mysql_store_result() failed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">mysql_close</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 关闭 MySQL 连接</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>  <span class="token comment">// 如果存储结果失败，返回 false</span>
    <span class="token punctuation">&#125;</span>    
    <span class="token comment">// 返回查询结果中行数是否大于0，如果有匹配的用户名返回 true，否则返回 false</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">mysql_num_rows</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>The next function is password check. It’s very easy to understand if you have comprehended the previous function.</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">bool <span class="token function">password_check</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>username<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>password<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    MYSQL <span class="token operator">*</span>conn<span class="token punctuation">;</span>
    MYSQL_RES <span class="token operator">*</span>res<span class="token punctuation">;</span>
    MYSQL_ROW row<span class="token punctuation">;</span>
    bool checkresult<span class="token punctuation">;</span>

    <span class="token keyword">char</span> query<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">snprintf</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"SELECT password FROM clients WHERE username='%s'"</span><span class="token punctuation">,</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    conn<span class="token operator">=</span><span class="token function">mysql_init</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>conn<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"mysql_init error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">mysql_real_connect</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"chat"</span><span class="token punctuation">,</span><span class="token string">"123456"</span><span class="token punctuation">,</span><span class="token string">"ChatClient"</span><span class="token punctuation">,</span><span class="token number">3306</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"mysql_real_connect error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">mysql_close</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">mysql_query</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Select Error: %s\n"</span><span class="token punctuation">,</span> <span class="token function">mysql_error</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">mysql_close</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    res<span class="token operator">=</span><span class="token function">mysql_store_result</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"mysql_store_result erro\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">mysql_close</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    row<span class="token operator">=</span><span class="token function">mysql_fetch_row</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"password from Web:%s\n"</span><span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"password from Mysql:%s\n"</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span>
        checkresult <span class="token operator">=</span> true<span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        checkresult <span class="token operator">=</span> false<span class="token punctuation">;</span>
    <span class="token function">mysql_free_result</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mysql_close</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>checkresult<span class="token punctuation">)</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"check successed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"check failed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> checkresult<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Last but not least.</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">bool <span class="token function">register_mysql</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>username<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>password<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    MYSQL <span class="token operator">*</span>conn<span class="token punctuation">;</span>
    <span class="token keyword">char</span> query<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    conn<span class="token operator">=</span><span class="token function">mysql_init</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>conn <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"mysql_init error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">mysql_real_connect</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token string">"chat"</span><span class="token punctuation">,</span> <span class="token string">"123456"</span><span class="token punctuation">,</span> <span class="token string">"ChatClient"</span><span class="token punctuation">,</span><span class="token number">3306</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"mysql_real_connect error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">mysql_close</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">snprintf</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"INSERT INTO clients (username, password) VALUES ('%s', '%s')"</span><span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">mysql_query</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"mysql_query error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">mysql_close</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> true<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3-data-matchinsert"><a class="markdownIt-Anchor" href="#3-data-matchinsert">#</a> 3. Data Match/Insert</h4>
<p>Here is a function that can extract the body message from a Json format string like this.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Received Body: <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token builtin class-name">:</span><span class="token string">"Sunday"</span>,<span class="token string">"password"</span><span class="token builtin class-name">:</span><span class="token string">"123456"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">extract_value</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>value<span class="token punctuation">,</span> <span class="token class-name">size_t</span> value_size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>key_pos <span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key_pos <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        key_pos <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>key_pos<span class="token punctuation">,</span> <span class="token char">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key_pos <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            key_pos<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span>key_pos <span class="token operator">==</span> <span class="token char">' '</span> <span class="token operator">||</span> <span class="token operator">*</span>key_pos <span class="token operator">==</span> <span class="token char">'"'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                key_pos<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">char</span> <span class="token operator">*</span>end_pos <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>key_pos<span class="token punctuation">,</span> <span class="token char">'"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>end_pos <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">size_t</span> len <span class="token operator">=</span> end_pos <span class="token operator">-</span> key_pos<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> value_size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token function">strncpy</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> key_pos<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    value<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    <span class="token function">strncpy</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> key_pos<span class="token punctuation">,</span> value_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    value<span class="token punctuation">[</span>value_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 如果没有找到结束引号，则值可能为空字符串</span>
                value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 如果没有找到冒号，则值可能为空字符串</span>
            value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 如果没有找到键，则值可能为空字符串</span>
        value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Then you can get the username and password.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Username: Sunday
Password: <span class="token number">123456</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>So it’s time to check them in mysql and response correctly.</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">bool <span class="token function">login_request</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>body<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> sock<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span> username<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> password<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 提取用户名和密码</span>
    <span class="token function">extract_value</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token string">"username"</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">extract_value</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">,</span> password<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Body内容:%s \n"</span><span class="token punctuation">,</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 打印提取的用户名和密码</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Username: %s\n"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Password: %s\n"</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">user_search</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">password_check</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">&#123;</span>
        <span class="token keyword">char</span> response<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
            <span class="token string">"HTTP/1.1 200 OK\r\n"</span>
            <span class="token string">"Content-Type: application/json\r\n"</span>
            <span class="token string">"Access-Control-Allow-Origin: *\r\n"</span>
            <span class="token string">"\r\n"</span>
            <span class="token string">"&#123;\"status\":\"success\", \"message\":\"Login Success\"&#125;"</span><span class="token punctuation">;</span>
        <span class="token function">send_response</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"login success \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span>
     <span class="token keyword">else</span>
     <span class="token punctuation">&#123;</span>
        <span class="token keyword">char</span> response<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
            <span class="token string">"HTTP/1.1 401 Unauthorized\r\n"</span>
            <span class="token string">"Content-Type: application/json\r\n"</span>
            <span class="token string">"Access-Control-Allow-Origin: *\r\n"</span>
            <span class="token string">"\r\n"</span>
            <span class="token string">"&#123;\"status\":\"error\", \"message\":\"Password Wrong\"&#125;"</span><span class="token punctuation">;</span>
        <span class="token function">send_response</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">char</span> response<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
        <span class="token string">"HTTP/1.1 401 Unauthorized\r\n"</span>
        <span class="token string">"Content-Type: application/json\r\n"</span>
        <span class="token string">"Access-Control-Allow-Origin: *\r\n"</span>
        <span class="token string">"\r\n"</span>
        <span class="token string">"&#123;\"status\":\"error\", \"message\":\"Username does not exists\"&#125;"</span><span class="token punctuation">;</span>
        <span class="token function">send_response</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>       
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>        
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> true<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">bool <span class="token function">register_request</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>body<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> sock<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span> username<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> password<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token function">extract_value</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token string">"username"</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">extract_value</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">,</span> password<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Body内容:%s \n"</span><span class="token punctuation">,</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 打印提取的用户名和密码</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Username: %s\n"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Password: %s\n"</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span><span class="token string">"\"username\":\"\""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">char</span> response<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
        <span class="token string">"HTTP/1.1 401 Unauthorized\r\n"</span>
        <span class="token string">"Content-Type: application/json\r\n"</span>
        <span class="token string">"Access-Control-Allow-Origin: *\r\n"</span>
        <span class="token string">"\r\n"</span>
        <span class="token string">"&#123;\"status\":\"error\", \"message\":\"Username can not be empty\"&#125;"</span><span class="token punctuation">;</span>
        <span class="token function">send_response</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Username Empty\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>        
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span><span class="token string">"\"password\":\"\""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">char</span> response<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
        <span class="token string">"HTTP/1.1 401 Unauthorized\r\n"</span>
        <span class="token string">"Content-Type: application/json\r\n"</span>
        <span class="token string">"Access-Control-Allow-Origin: *\r\n"</span>
        <span class="token string">"\r\n"</span>
        <span class="token string">"&#123;\"status\":\"error\", \"message\":\"Password can not be empty\"&#125;"</span><span class="token punctuation">;</span>
        <span class="token function">send_response</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Password Empty\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>        
    <span class="token punctuation">&#125;</span>   
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">user_search</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">char</span> response<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
        <span class="token string">"HTTP/1.1 401 Unauthorized\r\n"</span>
        <span class="token string">"Content-Type: application/json\r\n"</span>
        <span class="token string">"Access-Control-Allow-Origin: *\r\n"</span>
        <span class="token string">"\r\n"</span>
        <span class="token string">"&#123;\"status\":\"error\", \"message\":\"Username already exists\"&#125;"</span><span class="token punctuation">;</span>
        <span class="token function">send_response</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Username already exists\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>  
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">register_mysql</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"注册成功 \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span> response<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
        <span class="token string">"HTTP/1.1 200 Unauthorized\r\n"</span>
        <span class="token string">"Content-Type: application/json\r\n"</span>
        <span class="token string">"Access-Control-Allow-Origin: *\r\n"</span>
        <span class="token string">"\r\n"</span>
        <span class="token string">"&#123;\"status\":\"success\", \"message\":\"恭喜🎉:注册成功\"&#125;"</span><span class="token punctuation">;</span>
        <span class="token function">send_response</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Register Success\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//fflush(stdout);</span>

    <span class="token keyword">return</span> true<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">send_response</span><span class="token punctuation">(</span><span class="token keyword">int</span> clnt_sock<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">write</span><span class="token punctuation">(</span>clnt_sock<span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="2-chat-server"><a class="markdownIt-Anchor" href="#2-chat-server">#</a> 2. Chat Server</h3>
<p>Okay, here is the most important part: Chat Server.</p>
<p>Before I introduce the functions, let’s see what we would receive in the back-end.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">connected client: <span class="token number">5</span> 
msg大小为:2048,str_len大小为:489 
收到的原消息为: GET / HTTP/1.1
Host: <span class="token number">192.168</span>.31.137:7777
Pragma: no-cache
Accept: */*
Sec-WebSocket-Key: js+9AYMdpJsh9rhL87453g<span class="token operator">==</span>
Sec-WebSocket-Version: <span class="token number">13</span>
Accept-Language: en-US,en<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>
Sec-WebSocket-Extensions: permessage-deflate
Cache-Control: no-cache
Accept-Encoding: gzip, deflate
Origin: http://localhost:8080
User-Agent: Mozilla/5.0 <span class="token punctuation">(</span>Macintosh<span class="token punctuation">;</span> Intel Mac OS X 10_15_7<span class="token punctuation">)</span> AppleWebKit/605.1.15 <span class="token punctuation">(</span>KHTML, like Gecko<span class="token punctuation">)</span> Version/17.4.1 Safari/605.1.15
Connection: Upgrade
Upgrade: websocket


开始握手
拼接完成的str为:js+9AYMdpJsh9rhL87453g<span class="token operator">==</span>258EAFA5-E914-47DA-95CA-C5AB0DC85B11 
msg大小为:2048,str_len大小为:83 
解码后的消息: <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token builtin class-name">:</span><span class="token string">"&lt;span style=<span class="token entity" title="\&quot;">\"</span>color: blue;<span class="token entity" title="\&quot;">\"</span>>[Sunday]&lt;/span>"</span>,<span class="token string">"content"</span><span class="token builtin class-name">:</span><span class="token string">"hello"</span><span class="token punctuation">&#125;</span>
解码后的消息为: <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token builtin class-name">:</span><span class="token string">"&lt;span style=<span class="token entity" title="\&quot;">\"</span>color: blue;<span class="token entity" title="\&quot;">\"</span>>[Sunday]&lt;/span>"</span>,<span class="token string">"content"</span><span class="token builtin class-name">:</span><span class="token string">"hello"</span><span class="token punctuation">&#125;</span>
msg大小为:2048,str_len大小为:77 
解码后的消息: <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token builtin class-name">:</span><span class="token string">"&lt;span style=<span class="token entity" title="\&quot;">\"</span>color: blue;<span class="token entity" title="\&quot;">\"</span>>[Xyh]&lt;/span>"</span>,<span class="token string">"content"</span><span class="token builtin class-name">:</span><span class="token string">"hi"</span><span class="token punctuation">&#125;</span>
解码后的消息为: <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token builtin class-name">:</span><span class="token string">"&lt;span style=<span class="token entity" title="\&quot;">\"</span>color: blue;<span class="token entity" title="\&quot;">\"</span>>[Xyh]&lt;/span>"</span>,<span class="token string">"content"</span><span class="token builtin class-name">:</span><span class="token string">"hi"</span><span class="token punctuation">&#125;</span>
msg大小为:2048,str_len大小为:78 
解码后的消息: <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token builtin class-name">:</span><span class="token string">"&lt;span style=<span class="token entity" title="\&quot;">\"</span>color: blue;<span class="token entity" title="\&quot;">\"</span>>[Xyh]&lt;/span>"</span>,<span class="token string">"content"</span><span class="token builtin class-name">:</span><span class="token string">"hey"</span><span class="token punctuation">&#125;</span>
解码后的消息为: <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token builtin class-name">:</span><span class="token string">"&lt;span style=<span class="token entity" title="\&quot;">\"</span>color: blue;<span class="token entity" title="\&quot;">\"</span>>[Xyh]&lt;/span>"</span>,<span class="token string">"content"</span><span class="token builtin class-name">:</span><span class="token string">"hey"</span><span class="token punctuation">&#125;</span>
^C<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Okay, it’s a little complicit for beginners, I will explain this step by step.</p>
<p>First, what happens if the clients log in successfully and then enter the chatroom? Yes, the websocket function will send an HTTP request to the server to upgrade the protocol from http to websocket. So, how does it work?</p>
<p>You can see the HTTP message above, it includes a websocket key that was created randomly, you need to respond correctly, AKA, handshake. So the point is, how to respond?</p>
<h4 id="1-handshake"><a class="markdownIt-Anchor" href="#1-handshake">#</a> 1. HandShake</h4>
<p>Here is the process.</p>
<ol>
<li>
<p><strong>First, you need a magic key. Yeah, it was specified by the WebSocket protocol.</strong></p>
</li>
<li>
<p><strong>Then you need to combine it with the WebSocket key sent from the clients.</strong></p>
</li>
<li>
<p><strong>Calculate the HASH code of the combined string.</strong></p>
</li>
<li>
<p><strong>Encode the HASH code with base64.</strong></p>
</li>
<li>
<p><strong>Respond with an HTTP request.</strong></p>
</li>
</ol>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// 执行 WebSocket 握手</span>
<span class="token keyword">void</span> <span class="token function">perform_handshake</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>req<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>magic <span class="token operator">=</span> <span class="token string">"258EAFA5-E914-47DA-95CA-C5AB0DC85B11"</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> response<span class="token punctuation">[</span>BUF_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> key<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>key_start <span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token string">"Sec-WebSocket-Key: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key_start<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        key_start <span class="token operator">+=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"Sec-WebSocket-Key: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span> <span class="token operator">*</span>key_end <span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>key_start<span class="token punctuation">,</span> <span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key_end<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">strncpy</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> key_start<span class="token punctuation">,</span> key_end <span class="token operator">-</span> key_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
            key<span class="token punctuation">[</span>key_end <span class="token operator">-</span> key_start<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>

            <span class="token comment">// 拼接客户端密钥和魔法字符串</span>
            <span class="token keyword">char</span> accept_key<span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token function">snprintf</span><span class="token punctuation">(</span>accept_key<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>accept_key<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%s%s"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> magic<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"拼接完成的str为:%s \n"</span><span class="token punctuation">,</span>accept_key<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 计算 SHA1 哈希</span>
            <span class="token keyword">unsigned</span> <span class="token keyword">char</span> hash<span class="token punctuation">[</span>SHA_DIGEST_LENGTH<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token function">SHA1</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>accept_key<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>accept_key<span class="token punctuation">)</span><span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Base64 编码</span>
            <span class="token keyword">char</span> <span class="token operator">*</span>encoded_hash <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">snprintf</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">,</span>
                     <span class="token string">"HTTP/1.1 101 Switching Protocols\r\n"</span>
                     <span class="token string">"Upgrade: websocket\r\n"</span>
                     <span class="token string">"Connection: Upgrade\r\n"</span>
                     <span class="token string">"Sec-WebSocket-Accept: %s\r\n\r\n"</span><span class="token punctuation">,</span>
                     encoded_hash<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">write</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 发送握手响应</span>
            <span class="token function">free</span><span class="token punctuation">(</span>encoded_hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// Base64 编码函数</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>input<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    BIO <span class="token operator">*</span>bmem<span class="token punctuation">,</span> <span class="token operator">*</span>b64<span class="token punctuation">;</span>
    BUF_MEM <span class="token operator">*</span>bptr<span class="token punctuation">;</span>

    b64 <span class="token operator">=</span> <span class="token function">BIO_new</span><span class="token punctuation">(</span><span class="token function">BIO_f_base64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bmem <span class="token operator">=</span> <span class="token function">BIO_new</span><span class="token punctuation">(</span><span class="token function">BIO_s_mem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    b64 <span class="token operator">=</span> <span class="token function">BIO_push</span><span class="token punctuation">(</span>b64<span class="token punctuation">,</span> bmem<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">BIO_write</span><span class="token punctuation">(</span>b64<span class="token punctuation">,</span> input<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">BIO_flush</span><span class="token punctuation">(</span>b64<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">BIO_get_mem_ptr</span><span class="token punctuation">(</span>b64<span class="token punctuation">,</span> <span class="token operator">&amp;</span>bptr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">char</span> <span class="token operator">*</span>buff <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>bptr<span class="token operator">-></span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>buff<span class="token punctuation">,</span> bptr<span class="token operator">-></span>data<span class="token punctuation">,</span> bptr<span class="token operator">-></span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buff<span class="token punctuation">[</span>bptr<span class="token operator">-></span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token function">BIO_free_all</span><span class="token punctuation">(</span>b64<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> buff<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2-multiple-threads-server"><a class="markdownIt-Anchor" href="#2-multiple-threads-server">#</a> 2. Multiple threads server</h4>
<p>Now let’s see how to get a simple multiple threads server.</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;openssl/sha.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;openssl/evp.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;openssl/bio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;openssl/buffer.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iconv.h></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUF_SIZE</span> <span class="token expression"><span class="token number">2048</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAX_CLNT</span> <span class="token expression"><span class="token number">256</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SMALL_BUF</span> <span class="token expression"><span class="token number">20</span></span></span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">handle_clnt</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 处理客户端连接的线程函数</span>
<span class="token keyword">void</span> <span class="token function">error_handling</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 错误处理函数</span>
<span class="token keyword">void</span> <span class="token function">send_message</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>msg<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">,</span> <span class="token keyword">int</span> sock<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 发送消息给所有客户端</span>
<span class="token keyword">void</span> <span class="token function">perform_handshake</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 执行 WebSocket 握手</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>input<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Base64 编码函数</span>
<span class="token keyword">int</span> <span class="token function">encode_frame</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>msg<span class="token punctuation">,</span> <span class="token keyword">int</span> msg_len<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>encoded_msg<span class="token punctuation">,</span> <span class="token keyword">int</span> encoded_msg_len<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 编码 WebSocket 帧</span>
<span class="token keyword">int</span> <span class="token function">decode_frame</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>encoded_msg<span class="token punctuation">,</span> <span class="token keyword">int</span> encoded_msg_len<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>msg<span class="token punctuation">,</span> <span class="token keyword">int</span> msg_len<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 解码 WebSocket 帧</span>
<span class="token keyword">int</span> <span class="token function">read_full_frame</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> buffer_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">convert_encoding</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>from_encoding<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>to_encoding<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>input<span class="token punctuation">,</span> <span class="token class-name">size_t</span> input_size<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>output<span class="token punctuation">,</span> <span class="token class-name">size_t</span> output_size<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> clnt_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 当前连接的客户端数量</span>
<span class="token keyword">int</span> clnt_socks<span class="token punctuation">[</span>MAX_CLNT<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 客户端套接字数组</span>
<span class="token class-name">pthread_mutex_t</span> mutx<span class="token punctuation">;</span>  <span class="token comment">// 互斥锁</span>

<span class="token comment">// 编译命令: gcc -g server.c -o cser -lssl -lcrypto -lpthread -liconv</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token keyword">const</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> serv_sock<span class="token punctuation">,</span> clnt_sock<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> serv_adr<span class="token punctuation">,</span> clnt_adr<span class="token punctuation">;</span>
    <span class="token class-name">socklen_t</span> clnt_adr_sz<span class="token punctuation">;</span>

    <span class="token class-name">pthread_t</span> t_id<span class="token punctuation">;</span>
    
    <span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutx<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 初始化互斥锁</span>

    serv_sock <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>PF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 创建服务器套接字</span>
    
    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>serv_adr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>serv_adr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    serv_adr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
    serv_adr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    serv_adr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">7777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>serv_sock<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>serv_adr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>serv_adr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token function">error_handling</span><span class="token punctuation">(</span><span class="token string">"bind error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 绑定地址和端口</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">listen</span><span class="token punctuation">(</span>serv_sock<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token function">error_handling</span><span class="token punctuation">(</span><span class="token string">"listen error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 监听端口</span>
    
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        clnt_adr_sz <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>clnt_adr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        clnt_sock <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>serv_sock<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>clnt_adr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>clnt_adr_sz<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 接受客户端连接</span>

        <span class="token comment">// 将套接字添加到客户端套接字数组中</span>
        <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        clnt_socks<span class="token punctuation">[</span>clnt_cnt<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> clnt_sock<span class="token punctuation">;</span>
        <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutx<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建线程处理客户端连接</span>
        <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>t_id<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> handle_clnt<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>clnt_sock<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">pthread_detach</span><span class="token punctuation">(</span>t_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"connected client: %d \n"</span><span class="token punctuation">,</span> clnt_sock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">close</span><span class="token punctuation">(</span>serv_sock<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 关闭服务器套接字</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>It’s very simple so I won’t explain it anymore, but a point we need to notice is that I didn’t use a thread pool to manage these threads, it’s not good, I will update it in the future.</p>
<h4 id="3-handle-the-clients"><a class="markdownIt-Anchor" href="#3-handle-the-clients">#</a> 3. Handle the clients</h4>
<p>The most important thing here is that you need to encode and decode the websocket frames yourself, unlike HTTP frames. I will provide the functions below.</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">handle_clnt</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> sock <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> str_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">;</span>
    <span class="token keyword">int</span> zero_cnt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> msg<span class="token punctuation">[</span>BUF_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
    bool handshake_done <span class="token operator">=</span> false<span class="token punctuation">;</span>  <span class="token comment">// 标志位，标识是否已经完成握手</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>str_len <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> MSG_WAITALL<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>str_len<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
          zero_cnt<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
          zero_cnt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>zero_cnt<span class="token operator">></span><span class="token number">5</span><span class="token punctuation">)</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"msg大小为:%lu,str_len大小为:%d \n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">,</span>str_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        msg<span class="token punctuation">[</span>str_len<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>  <span class="token comment">// 确保字符串以 null 结尾</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>handshake_done<span class="token punctuation">)</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"收到的原消息为: %s\n"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>handshake_done <span class="token operator">&amp;&amp;</span> <span class="token function">strstr</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token string">"Upgrade: websocket"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 检查是否为 WebSocket 握手请求</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"开始握手\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">perform_handshake</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 执行握手</span>
            handshake_done <span class="token operator">=</span> true<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 解码 WebSocket 帧</span>
            <span class="token keyword">char</span> decoded_msg<span class="token punctuation">[</span>BUF_SIZE<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token comment">// 初始化并清空解码消息缓冲区</span>
            <span class="token keyword">int</span> decoded_len <span class="token operator">=</span> <span class="token function">decode_frame</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> str_len<span class="token punctuation">,</span> decoded_msg<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>decoded_msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>decoded_len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"解码后的消息为: %s\n"</span><span class="token punctuation">,</span> decoded_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">send_message</span><span class="token punctuation">(</span>decoded_msg<span class="token punctuation">,</span> decoded_len<span class="token punctuation">,</span> sock<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 发送消息</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">memset</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 清空消息缓冲区</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 客户端断开连接</span>
    <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> clnt_cnt<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>clnt_socks<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> sock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> clnt_cnt <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
                clnt_socks<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> clnt_socks<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    clnt_cnt<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>sock<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 关闭客户端套接字</span>
    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// 发送消息给所有客户端，除了发送者</span>
<span class="token keyword">void</span> <span class="token function">send_message</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>msg<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">,</span> <span class="token keyword">int</span> sock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">char</span> encoded_msg<span class="token punctuation">[</span>BUF_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 包装消息为JSON格式</span>

    <span class="token keyword">int</span> encoded_len <span class="token operator">=</span> <span class="token function">encode_frame</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> len<span class="token punctuation">,</span> encoded_msg<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>encoded_msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 编码 WebSocket 帧</span>

    <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> clnt_cnt<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>clnt_socks<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> sock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">write</span><span class="token punctuation">(</span>clnt_socks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> encoded_msg<span class="token punctuation">,</span> encoded_len<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 发送消息</span>
        <span class="token punctuation">&#125;</span>
    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutx<span class="token punctuation">)</span><span class="token punctuation">;</span>      
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// 编码 WebSocket 帧</span>
<span class="token keyword">int</span> <span class="token function">encode_frame</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>msg<span class="token punctuation">,</span> <span class="token keyword">int</span> msg_len<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>encoded_msg<span class="token punctuation">,</span> <span class="token keyword">int</span> encoded_msg_len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    encoded_msg<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x81</span><span class="token punctuation">;</span>  <span class="token comment">// FIN + 文本帧</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg_len <span class="token operator">&lt;=</span> <span class="token number">125</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        encoded_msg<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> msg_len<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>msg_len <span class="token operator">&lt;=</span> <span class="token number">65535</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        encoded_msg<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">126</span><span class="token punctuation">;</span>
        encoded_msg<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>msg_len <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
        encoded_msg<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> msg_len <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        encoded_msg<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            encoded_msg<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>msg_len <span class="token operator">>></span> <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">memcpy</span><span class="token punctuation">(</span>encoded_msg <span class="token operator">+</span> idx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> msg_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> idx <span class="token operator">+</span> msg_len<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// 解码 WebSocket 帧</span>
<span class="token keyword">int</span> <span class="token function">decode_frame</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>encoded_msg<span class="token punctuation">,</span> <span class="token keyword">int</span> encoded_msg_len<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>msg<span class="token punctuation">,</span> <span class="token keyword">int</span> msg_len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>encoded_msg_len <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">int</span> idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> byte <span class="token operator">=</span> encoded_msg<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>byte <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 检查 FIN 位，确保这是最后一帧</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    byte <span class="token operator">=</span> encoded_msg<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> payload_len <span class="token operator">=</span> byte <span class="token operator">&amp;</span> <span class="token number">0x7F</span><span class="token punctuation">;</span>  <span class="token comment">// 获取负载长度</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>payload_len <span class="token operator">==</span> <span class="token number">126</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 如果负载长度是 126，那么接下来的两个字节表示实际长度</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>encoded_msg_len <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">int</span> high_byte <span class="token operator">=</span> encoded_msg<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> low_byte <span class="token operator">=</span> encoded_msg<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        payload_len <span class="token operator">=</span> <span class="token punctuation">(</span>high_byte <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> low_byte<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>payload_len <span class="token operator">==</span> <span class="token number">127</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 如果负载长度是 127，那么接下来的八个字节表示实际长度</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>encoded_msg_len <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        payload_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            payload_len <span class="token operator">=</span> <span class="token punctuation">(</span>payload_len <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> encoded_msg<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>encoded_msg_len <span class="token operator">&lt;</span> idx <span class="token operator">+</span> payload_len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 检查数据长度是否匹配</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    bool masked <span class="token operator">=</span> <span class="token punctuation">(</span>byte <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 检查 MASK 位</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> masking_key<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>masked<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            masking_key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> encoded_msg<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> payload_len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> encoded_msg<span class="token punctuation">[</span>idx <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token punctuation">(</span>masked <span class="token operator">?</span> masking_key<span class="token punctuation">[</span>i <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 解码负载数据</span>
    <span class="token punctuation">&#125;</span>
    
    msg<span class="token punctuation">[</span>payload_len<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>  <span class="token comment">// 确保消息以空字符结尾</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"解码后的消息: %s\n"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> payload_len<span class="token punctuation">;</span>  <span class="token comment">// 返回负载长度</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Remember to check the mask bit, if it was 1, then you also need to encode the frame with the mask code.</p>
<h3 id="3-signaling"><a class="markdownIt-Anchor" href="#3-signaling">#</a> 3. Signaling</h3>
<p>To be continued.</p>
<h2 id="3-develop-tools-and-plugins"><a class="markdownIt-Anchor" href="#3-develop-tools-and-plugins">#</a> 3. Develop Tools and plugins</h2>
<h3 id="1-vscode"><a class="markdownIt-Anchor" href="#1-vscode">#</a> 1. Vscode</h3>
<h4 id="plugins"><a class="markdownIt-Anchor" href="#plugins">#</a> Plugins:</h4>
<h5 id="1-mysql"><a class="markdownIt-Anchor" href="#1-mysql">#</a> 1. MySQL</h5>
<p><img data-src="https://raw.githubusercontent.com/Hexlove2/images1/main/images/Screenshot%202024-06-30%20at%2015.07.12.png" alt="Screenshot 2024-06-30 at 15.07.12"></p>
<h5 id="2-vue"><a class="markdownIt-Anchor" href="#2-vue">#</a> 2. Vue</h5>
<p><img data-src="https://raw.githubusercontent.com/Hexlove2/images1/main/images/Screenshot%202024-07-09%20at%205.07.30%E2%80%AFPM.png" alt="Screenshot 2024-07-09 at 5.07.30 PM"></p>
<h3 id="2-mysql"><a class="markdownIt-Anchor" href="#2-mysql">#</a> 2. mysql</h3>
<p>Using Mysql 8.0.37</p>
<img data-src="https://raw.githubusercontent.com/Hexlove2/images1/main/images/Screenshot%202024-06-30%20at%2015.04.48.png" alt="Screenshot 2024-06-30 at 15.04.48" style="zoom: 33%;" />
<h2 id="4results-demonstration"><a class="markdownIt-Anchor" href="#4results-demonstration">#</a> 4.Results Demonstration</h2>
<p><img data-src="https://raw.githubusercontent.com/Hexlove2/images1/main/images/Screenshot%202024-07-09%20at%205.37.47%E2%80%AFPM.png" alt="Screenshot 2024-07-09 at 5.37.47 PM"></p>
<p><img data-src="https://raw.githubusercontent.com/Hexlove2/images1/main/images/Screenshot%202024-07-09%20at%205.38.22%E2%80%AFPM.png" alt="Screenshot 2024-07-09 at 5.38.22 PM"></p>
<p><img data-src="https://raw.githubusercontent.com/Hexlove2/images1/main/images/Screenshot%202024-07-09%20at%205.40.58%E2%80%AFPM.png" alt="Screenshot 2024-07-09 at 5.39.14 PM"></p>

  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2024-07-09 18:41:31" itemprop="dateModified" datetime="2024-07-09T18:41:31+09:00">2024-07-09</time>
  </span>
</div>

      
<div class="reward">
  <checkbox><i class="ic i-heartbeat"></i> Donate</checkbox>
  <p>Give me a cup of [coffee]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="Sunday WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="Sunday Alipay">
        <p>Alipay</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt="Sunday PayPal">
        <p>PayPal</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>Post author:  </strong>Sunday <i class="ic i-at"><em>@</em></i>Sunday
  </li>
  <li class="link">
    <strong>Post link: </strong>
    <a href="http://hexlove2.github.io/2024/07/01/Projects/ChatWeb/" title="ChatWeb Project">http://hexlove2.github.io/2024/07/01/Projects/ChatWeb/</a>
  </li>
  <li class="license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2024/02/29/Notes/Socket%20learning/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;Hexlove2&#x2F;images1&#x2F;main&#x2F;images2&#x2F;29.jpg" title="TCP&#x2F;IP Socket Coding">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> Notes</span>
  <h3>TCP/IP Socket Coding</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2024/07/07/Notes/%E9%9D%A2%E8%AF%95%E9%A2%98/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;Hexlove2&#x2F;images1&#x2F;main&#x2F;images2&#x2F;16.jpg" title="Interview Questions">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> Notes</span>
  <h3>Interview Questions</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#chatweb-project-notes"><span class="toc-number">1.</span> <span class="toc-text"> ChatWeb project notes</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#abstract"><span class="toc-number">1.1.</span> <span class="toc-text"> Abstract:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-front-end"><span class="toc-number">1.2.</span> <span class="toc-text"> 1. Front-End</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-vue"><span class="toc-number">1.2.1.</span> <span class="toc-text"> 1. Vue</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1set-your-page"><span class="toc-number">1.2.1.1.</span> <span class="toc-text"> 1.Set your page</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-coding-about-the-home-page"><span class="toc-number">1.2.1.2.</span> <span class="toc-text"> 2. Coding about the home page.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-coding-about-the-chat-room"><span class="toc-number">1.2.1.3.</span> <span class="toc-text"> 3. Coding about the chat room</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-webrtc"><span class="toc-number">1.2.2.</span> <span class="toc-text"> 2. Webrtc</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-back-end"><span class="toc-number">1.3.</span> <span class="toc-text"> 2. Back-End</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-http-server"><span class="toc-number">1.3.1.</span> <span class="toc-text"> 1. HTTP Server</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-preprocessor"><span class="toc-number">1.3.1.1.</span> <span class="toc-text"> 1. Preprocessor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-usage-of-mysql"><span class="toc-number">1.3.1.2.</span> <span class="toc-text"> 2. Usage of MySql</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-data-matchinsert"><span class="toc-number">1.3.1.3.</span> <span class="toc-text"> 3. Data Match&#x2F;Insert</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-chat-server"><span class="toc-number">1.3.2.</span> <span class="toc-text"> 2. Chat Server</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-handshake"><span class="toc-number">1.3.2.1.</span> <span class="toc-text"> 1. HandShake</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-multiple-threads-server"><span class="toc-number">1.3.2.2.</span> <span class="toc-text"> 2. Multiple threads server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-handle-the-clients"><span class="toc-number">1.3.2.3.</span> <span class="toc-text"> 3. Handle the clients</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-signaling"><span class="toc-number">1.3.3.</span> <span class="toc-text"> 3. Signaling</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-develop-tools-and-plugins"><span class="toc-number">1.4.</span> <span class="toc-text"> 3. Develop Tools and plugins</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-vscode"><span class="toc-number">1.4.1.</span> <span class="toc-text"> 1. Vscode</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#plugins"><span class="toc-number">1.4.1.1.</span> <span class="toc-text"> Plugins:</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-mysql"><span class="toc-number">1.4.1.1.1.</span> <span class="toc-text"> 1. MySQL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-vue"><span class="toc-number">1.4.1.1.2.</span> <span class="toc-text"> 2. Vue</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-mysql"><span class="toc-number">1.4.2.</span> <span class="toc-text"> 2. mysql</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4results-demonstration"><span class="toc-number">1.5.</span> <span class="toc-text"> 4.Results Demonstration</span></a></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
        <ul>
          <li><a href="/2022/12/09/Projects/Fox%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/" rel="bookmark" title="Fox项目笔记">Fox项目笔记</a></li><li class="active"><a href="/2024/07/01/Projects/ChatWeb/" rel="bookmark" title="ChatWeb Project">ChatWeb Project</a></li><li><a href="/2025/02/18/Projects/httpserver/" rel="bookmark" title="Http Linux Server">Http Linux Server</a></li><li><a href="/2025/07/11/Projects/Liarbar/" rel="bookmark" title="Liar's Bar">Liar's Bar</a></li><li><a href="/2077/07/26/Projects/blogupdatelog/" rel="bookmark" title="Blog Changelog">Blog Changelog</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="Sunday"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">Sunday</p>
  <div class="description" itemprop="description">Later's better than never</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">22</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">5</span>
        <span class="name">categories</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">13</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0hleGxvdmUy" title="https:&#x2F;&#x2F;github.com&#x2F;Hexlove2"><i class="ic i-github"></i></span>
      <a href="/hexlove@163.com" title="hexlove@163.com" class="item email"><i class="ic i-envelope"></i></a>
      <span class="exturl item youtube" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vQFlpaGFuZ1h1MA==" title="https:&#x2F;&#x2F;www.youtube.com&#x2F;@YihangXu0"><i class="ic i-youtube"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>About</a>
  </li>

    
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-moon"></i>Art</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/paint/" rel="section"><i class="ic i-sun"></i>Paint</a>
  </li>

  </ul>
        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-sakura"></i>Demo</a>
    <ul class="submenu">

  </ul>

</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2024/02/29/Notes/Socket%20learning/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2024/07/07/Notes/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>Random Posts</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Journey/" title="In Journey">Journey</a>
</div>

    <span><a href="/2022/11/19/Journey/My%20diary/" title="First Diary">First Diary</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/book/" title="In book?">book?</a>
</div>

    <span><a href="/2022/12/11/Template/" title="Name">Name</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Coding/" title="In Coding">Coding</a>
</div>

    <span><a href="/2022/08/14/Coding/%E5%A4%9A%E9%80%9A%E9%81%93%E6%BC%8F%E9%95%80%E6%A3%80%E6%B5%8B%E9%97%AE%E9%A2%98/" title="Skip plating defect detection problem">Skip plating defect detection problem</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Projects/" title="In Projects">Projects</a>
</div>

    <span><a href="/2077/07/26/Projects/blogupdatelog/" title="Blog Changelog">Blog Changelog</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Coding/" title="In Coding">Coding</a>
</div>

    <span><a href="/2022/08/31/Coding/Comparison%20Between%20Hue%20and%20red%20subtract%20blue%20channel%20detect/" title="缺陷检测方法对比">缺陷检测方法对比</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Journey/" title="In Journey">Journey</a>
</div>

    <span><a href="/2022/10/29/Journey/hexo/" title="关于Hexo s显示正常但Hexo d没有更新内容的问题">关于Hexo s显示正常但Hexo d没有更新内容的问题</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Coding/" title="In Coding">Coding</a>
</div>

    <span><a href="/2024/08/06/Coding/frame/" title="Audio Frame Format Exchange">Audio Frame Format Exchange</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Notes/" title="In Notes">Notes</a>
</div>

    <span><a href="/2023/01/09/Notes/Csharp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="C#初级笔记">C#初级笔记</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Coding/" title="In Coding">Coding</a>
</div>

    <span><a href="/2025/05/18/Coding/threadpool/" title="C++ Concurrency - Thread pool">C++ Concurrency - Thread pool</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Projects/" title="In Projects">Projects</a>
</div>

    <span><a href="/2024/07/01/Projects/ChatWeb/" title="ChatWeb Project">ChatWeb Project</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>Recent Comments</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Sunday @ Hex</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2024/07/01/Projects/ChatWeb/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    copyright: 'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
