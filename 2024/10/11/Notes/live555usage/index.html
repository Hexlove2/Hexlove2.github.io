



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="Hex" href="http://hexlove2.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="Hex" href="http://hexlove2.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="Hex" href="http://hexlove2.github.io/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="live555, ffmpeg" />


<link rel="canonical" href="http://hexlove2.github.io/2024/10/11/Notes/live555usage/">



  <title>
Live555 Usage(FFmpeg) - Notes |
Hex = Hex = Looking for freedom of mind</title>
<meta name="generator" content="Hexo 6.3.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">Live555 Usage(FFmpeg)
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2024-10-12 00:00:00">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2024-10-12T00:00:00+09:00">2024-10-12</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Hex</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://raw.githubusercontent.com/Hexlove2/images1/main/images2/15.jpg"></li>
          <li class="item" data-background-image="https://raw.githubusercontent.com/Hexlove2/images1/main/images2/11.jpg"></li>
          <li class="item" data-background-image="https://raw.githubusercontent.com/Hexlove2/images1/main/images2/25.jpg"></li>
          <li class="item" data-background-image="https://raw.githubusercontent.com/Hexlove2/images1/main/images2/18.jpg"></li>
          <li class="item" data-background-image="https://raw.githubusercontent.com/Hexlove2/images1/main/images2/14.jpg"></li>
          <li class="item" data-background-image="https://raw.githubusercontent.com/Hexlove2/images1/main/images2/17.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span><i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Notes/" itemprop="item" rel="index" title="In Notes"><span itemprop="name">Notes</span></a>
<meta itemprop="position" content="1" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="http://hexlove2.github.io/2024/10/11/Notes/live555usage/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="Sunday">
    <meta itemprop="description" content="Looking for freedom of mind, Looking for freedom of mind">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hex">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h3 id="Platform-Win10-amp-MacOS15"><a href="#Platform-Win10-amp-MacOS15" class="headerlink" title="Platform: Win10 &amp; MacOS15"></a>Platform: Win10 &amp; MacOS15</h3><h3 id="Reference-FFMPEG-LIVE555"><a href="#Reference-FFMPEG-LIVE555" class="headerlink" title="Reference: FFMPEG, LIVE555"></a>Reference: FFMPEG, LIVE555</h3><h3 id="1-Source-Code-Download-Link-https-github-com-rgaufman-live555"><a href="#1-Source-Code-Download-Link-https-github-com-rgaufman-live555" class="headerlink" title="1. Source Code Download Link: https://github.com/rgaufman/live555"></a>1. Source Code Download Link: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JnYXVmbWFuL2xpdmU1NTU=">https://github.com/rgaufman/live555</span></h3><p>This repository was not published by the original team of Live555, but I can’t download it on their website. You can also try it before using this link to get the newest version.</p>
<h3 id="2-Build"><a href="#2-Build" class="headerlink" title="2. Build"></a>2. Build</h3><p>Unzip the file or use git, then you’ll get a folder including these files like this below. Then open it on the terminal.</p>
<p><img data-src="https://raw.githubusercontent.com/Hexlove2/images1/main/images/Screenshot%202024-10-12%20at%205.19.16%E2%80%AFPM.png" alt="Screenshot 2024-10-12 at 5.19.16 PM"></p>
<p>Then input</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">cd</span> live555</span><br><span class="line"><span class="comment"># if your platform is linux</span></span><br><span class="line">./genMakefiles linux</span><br><span class="line">make</span><br></pre></td></tr></table></figure>



<p><img data-src="https://raw.githubusercontent.com/Hexlove2/images1/main/images/Screenshot%202024-10-12%20at%205.22.22%E2%80%AFPM.png" alt="Screenshot 2024-10-12 at 5.22.22 PM"></p>
<p>Because my platform is Mac, so I need to choose this one.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">./genMakefiles macosx-bigsur</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<p>You can also look through some examples provided by the team in the folder named testProgs.</p>
<p>There is a clear and good example of a cpp file named testOnDemandRTSPServer.cpp.</p>
<h3 id="3-Usages"><a href="#3-Usages" class="headerlink" title="3. Usages"></a>3. Usages</h3><h4 id="1-Push-local-audio-and-video-files’-stream-to-an-RTSP-server"><a href="#1-Push-local-audio-and-video-files’-stream-to-an-RTSP-server" class="headerlink" title="1. Push local audio and video files’ stream to an RTSP server."></a>1. Push local audio and video files’ stream to an RTSP server.</h4><p>So, in order to do that, what you need to do first is just create an RTSP server, here is a template, and I will add some explanations in the code below.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;liveMedia.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;BasicUsageEnvironment.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GroupsockHelper.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Setting the basic environment.</span></span><br><span class="line">    <span class="comment">// cout &lt;&lt; &quot;Hello, World&quot;; Just a test, never mind.</span></span><br><span class="line">    TaskScheduler* scheduler = BasicTaskScheduler::<span class="built_in">createNew</span>();</span><br><span class="line">    UsageEnvironment* env = BasicUsageEnvironment::<span class="built_in">createNew</span>(*scheduler);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create the RTSP server </span></span><br><span class="line">    <span class="type">char</span> <span class="type">const</span>* rtspURL = <span class="string">&quot;rtsp://127.0.0.1:8554/liveTest&quot;</span>;</span><br><span class="line">    RTSPServer* rtspServer = RTSPServer::<span class="built_in">createNew</span>(*env, <span class="number">8554</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rtspServer == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        *env &lt;&lt; <span class="string">&quot;Failed to create RTSP client: &quot;</span> &lt;&lt; env-&gt;<span class="built_in">getResultMsg</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">char</span> <span class="type">const</span>* streamName    = <span class="string">&quot;liveTest&quot;</span>;</span><br><span class="line">        <span class="type">char</span> <span class="type">const</span>* videoFileName = <span class="string">&quot;test.264&quot;</span>;</span><br><span class="line">        <span class="type">char</span> <span class="type">const</span>* audioFileName = <span class="string">&quot;test.aac&quot;</span>;</span><br><span class="line">        ServerMediaSession* sms = ServerMediaSession::<span class="built_in">createNew</span>(*env, streamName, streamName);</span><br><span class="line">        sms-&gt;<span class="built_in">addSubsession</span>(H264VideoFileServerMediaSubsession::<span class="built_in">createNew</span>(*env, videoFileName, False));</span><br><span class="line"></span><br><span class="line">        sms-&gt;<span class="built_in">addSubsession</span>(ADTSAudioFileServerMediaSubsession::<span class="built_in">createNew</span>(*env, audioFileName, False));</span><br><span class="line">        rtspServer-&gt;<span class="built_in">addServerMediaSession</span>(sms);</span><br><span class="line">        <span class="comment">// announceStream();</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Event Loop</span></span><br><span class="line">    env-&gt;<span class="built_in">taskScheduler</span>().<span class="built_in">doEventLoop</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Btw, you need to prepare both the source audio and video files in advance in the folder of your final executable file just like this</p>
<p><img data-src="https://raw.githubusercontent.com/Hexlove2/images1/main/images/e39485eaad25fd4b7de3ed8d976a2fdc.png" alt="e39485eaad25fd4b7de3ed8d976a2fdc"></p>
<p>test.264 and test.aac.</p>
<p>If you just want to have a test and you don’t have any files like these, you can download any mp4 format video and extract the audio and video parts into these files. You can use a FFmpeg command line like this:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ffmpeg -i input.mp4 -c:v copy -an -bsf:v h264_mp4toannexb test.264 -c:a copy -vn test.aac</span><br></pre></td></tr></table></figure>

<p>You only need to download some test videos and name them input.mp4, then execute this command on your terminal.</p>
<p>You can test it on any app that can watch the RTSP stream. Like the pot player, or you can just execute this command:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ffplay rtsp://192.168.1.18:8554/liveTest</span><br></pre></td></tr></table></figure>

<p>Remember to replace the IP. If you test it on the same device, you should replace it with 127.0.0.1</p>
<p>Alright, this example is tiny and concise, Let’s discuss another situation when you need to customize your own source like a camera source.</p>
<h4 id="2-Push-the-camera-stream-to-an-RTSP-server"><a href="#2-Push-the-camera-stream-to-an-RTSP-server" class="headerlink" title="2. Push the camera stream to an RTSP server."></a>2. Push the camera stream to an RTSP server.</h4><p>This demand is way harder if you haven’t used it before. So first of all, you need a camera source, which means you need to have a place to get the data and send them to the source, you can use OpenCV or FFmpeg to get H264 data, it’s not the point we should talk about here.</p>
<p>Suppose we have a source like this:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">decodec_packet_cb</span><span class="params">(video_packet * packet, <span class="type">void</span> * userdata)</span></span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">  	<span class="type">bool</span> live_On = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (live_On)</span><br><span class="line">    &#123;   </span><br><span class="line">      	<span class="comment">//send the data</span></span><br><span class="line">        <span class="built_in">sender_data_cb</span>(&amp;x_rtspHandle, packet-&gt;buf, packet-&gt;len);</span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="comment">//This is for decoding</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">lb_videocodec_packet_cb</span>(packet, userdata);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>First of all, open the server.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">//capture thread</span></span><br><span class="line">  <span class="comment">//.</span></span><br><span class="line">  <span class="comment">//encode thread</span></span><br><span class="line">  <span class="comment">//.</span></span><br><span class="line">  <span class="type">void</span>* rtspHandle;</span><br><span class="line">  <span class="built_in">rtsp_create</span>(&amp;rtspHandle);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Create the thread.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rtsp_create</span><span class="params">(<span class="type">void</span> ** handle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">std::thread <span class="title">rtsp_thread</span><span class="params">(rtsp_proc_xyh, handle)</span></span>;</span><br><span class="line">    rtsp_thread.<span class="built_in">detach</span>();</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lk</span><span class="params">(cv_m2)</span></span>;</span><br><span class="line">        cv2.<span class="built_in">wait</span>(lk, [] &#123;<span class="keyword">return</span> ready; &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here is the code of the thread</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">rtsp_proc_xyh</span><span class="params">(<span class="type">void</span> ** handle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TaskScheduler* scheduler = BasicTaskScheduler::<span class="built_in">createNew</span>();</span><br><span class="line">    UsageEnvironment* env = BasicUsageEnvironment::<span class="built_in">createNew</span>(*scheduler);</span><br><span class="line"></span><br><span class="line">    RTSPServer* rtspServer = RTSPServer::<span class="built_in">createNew</span>(*env, <span class="number">8554</span>);</span><br><span class="line">    <span class="keyword">if</span> (!rtspServer) &#123;</span><br><span class="line">        *env &lt;&lt; <span class="string">&quot;failed to create RTSP server: &quot;</span> &lt;&lt; env-&gt;<span class="built_in">getResultMsg</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="built_in">SLOG_ERROR</span>(<span class="string">&quot;failed to create RTSP server: %s&quot;</span>, env-&gt;<span class="built_in">getResultMsg</span>());</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ServerMediaSession* sms = ServerMediaSession::<span class="built_in">createNew</span>(*env, <span class="string">&quot;liveStream&quot;</span>, <span class="string">&quot;liveStream&quot;</span>, <span class="string">&quot;H.264 stream&quot;</span>);</span><br><span class="line">    XyhCapLiveServerMediaSession* LiveSession = XyhCapLiveServerMediaSession::<span class="built_in">createNew</span>(*env, <span class="literal">NULL</span>, <span class="literal">false</span>);</span><br><span class="line">    sms-&gt;<span class="built_in">addSubsession</span>(LiveSession);</span><br><span class="line">    rtspServer-&gt;<span class="built_in">addServerMediaSession</span>(sms);</span><br><span class="line">    *handle = LiveSession;</span><br><span class="line">    *env &lt;&lt; <span class="string">&quot;Stream ready at rtsp://127.0.0.1:8554/liveStream\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lk</span><span class="params">(cv_m2)</span></span>;</span><br><span class="line">        ready = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cv2.<span class="built_in">notify_one</span>();</span><br><span class="line">    env-&gt;<span class="built_in">taskScheduler</span>().<span class="built_in">doEventLoop</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can notice that there is a customized class: XyhCapLiveServerMediaSession</p>
<p>Here is the code for this class</p>
<p>OnDemandServerMediaSubsession is the base class.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">XyhCapLiveServerMediaSession</span> : <span class="keyword">public</span> OnDemandServerMediaSubsession</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> XyhCapLiveServerMediaSession* <span class="title">createNew</span><span class="params">(UsageEnvironment&amp; env, <span class="type">char</span> <span class="type">const</span>* fileName, Boolean reuseFirstSource)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">XyhCapLiveServerMediaSession</span>(env, reuseFirstSource);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">XyhframeSource* <span class="title">getSource</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> framesource;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">bool</span> isReady;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="built_in">XyhCapLiveServerMediaSession</span>(UsageEnvironment&amp; env, Boolean reuseFirstSource) : <span class="built_in">OnDemandServerMediaSubsession</span>(env, reuseFirstSource) &#123;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">XyhCapLiveServerMediaSession</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//delete[] fAuxSDPLine;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">char</span> <span class="type">const</span>* <span class="title">getAuxSDPLine</span><span class="params">(RTPSink* rtpSink, FramedSource* inputSource)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> FramedSource* <span class="title">createNewStreamSource</span><span class="params">(<span class="type">unsigned</span> clientSessionId, <span class="type">unsigned</span>&amp; estBitrate)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> RTPSink* <span class="title">createNewRTPSink</span><span class="params">(Groupsock* rtpGroupsock, <span class="type">unsigned</span> <span class="type">char</span> rtpPayLoadTypeIfDynamic, FramedSource* inputSource)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span>* fAuxSDPLine;</span><br><span class="line">    <span class="type">char</span> fDoneFlag;</span><br><span class="line">    RTPSink* fDummyRTPSink;</span><br><span class="line">    XyhframeSource* framesource;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">FramedSource* <span class="title">XyhCapLiveServerMediaSession::createNewStreamSource</span><span class="params">(<span class="type">unsigned</span> clientSessionId, <span class="type">unsigned</span>&amp; estBitrate)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    estBitrate = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line">    XyhframeSource* videoSource = XyhframeSource::<span class="built_in">createNew</span>(<span class="built_in">envir</span>());</span><br><span class="line">    <span class="keyword">if</span> (!videoSource)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    framesource = videoSource;</span><br><span class="line">    isReady = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//    return H264VideoStreamFramer::createNew(envir(), videoSource);</span></span><br><span class="line">    <span class="keyword">return</span> videoSource;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">RTPSink* <span class="title">XyhCapLiveServerMediaSession::createNewRTPSink</span><span class="params">(Groupsock* rtpGroupsock, <span class="type">unsigned</span> <span class="type">char</span> rtpPayLoadTypeIfDynamic, FramedSource* inputSource)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> H264VideoRTPSink::<span class="built_in">createNew</span>(<span class="built_in">envir</span>(), rtpGroupsock, rtpPayLoadTypeIfDynamic);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">char</span> <span class="type">const</span>* <span class="title">XyhCapLiveServerMediaSession::getAuxSDPLine</span><span class="params">(RTPSink* rtpSink, FramedSource* inputSource)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The other class you need to customize is Framesource. I named it XyhframeSource here.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">XyhframeSource</span> : <span class="keyword">public</span> FramedSource</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> is_run;</span><br><span class="line">    <span class="function"><span class="type">static</span> XyhframeSource* <span class="title">createNew</span><span class="params">(UsageEnvironment&amp; env)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">XyhframeSource</span>(env);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">send_data</span><span class="params">(<span class="type">void</span>*data, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mutex)</span></span>;</span><br><span class="line">            <span class="type">uint8_t</span>* copiedData = <span class="keyword">new</span> <span class="type">uint8_t</span>[size];</span><br><span class="line">            <span class="built_in">memcpy</span>(copiedData, data, size);</span><br><span class="line">            nalQueue.<span class="built_in">push</span>(std::<span class="built_in">make_pair</span>(copiedData, size));</span><br><span class="line">            cv.<span class="built_in">notify_one</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span>(<span class="type">const</span> std::system_error&amp; e)&#123;</span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;Error222: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="built_in">XyhframeSource</span>(UsageEnvironment&amp; env) : <span class="built_in">FramedSource</span>(env), <span class="built_in">nalData</span>(<span class="literal">nullptr</span>), <span class="built_in">nalSize</span>(<span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">            fFrameSize = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">XyhframeSource</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">doGetNextFrame</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ready2 = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mutex)</span></span>;</span><br><span class="line">            cv.<span class="built_in">wait</span>(lock, [<span class="keyword">this</span>]() &#123;<span class="keyword">return</span> !nalQueue.<span class="built_in">empty</span>(); &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> nalUnit = nalQueue.<span class="built_in">front</span>();</span><br><span class="line">            nalQueue.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">            nalData = nalUnit.first;</span><br><span class="line">            nalSize = nalUnit.second;</span><br><span class="line">            <span class="keyword">if</span> (nalSize &gt; fMaxSize) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//    std::cout &lt;&lt; &quot;FMAX: &quot; &lt;&lt; fMaxSize &lt;&lt; &quot;  CURRENT SIZE: &quot; &lt;&lt; nalSize &lt;&lt; std::endl;</span></span><br><span class="line">            <span class="built_in">memmove</span>(fTo, nalData, nalSize);</span><br><span class="line">            fFrameSize = nalSize;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">delete</span>[] nalData;</span><br><span class="line">            nalData = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">gettimeofday</span>(&amp;fPresentationTime, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">            FramedSource::<span class="built_in">afterGetting</span>(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span>(<span class="type">const</span> std::system_error&amp; e)&#123;</span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;Error111: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">        &#125;         </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">doStopGettingFrames</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;STOP GETTING FRAMES&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::queue&lt;std::pair&lt;<span class="type">uint8_t</span>*, <span class="type">int</span>&gt;&gt; nalQueue;</span><br><span class="line">    std::mutex mutex;</span><br><span class="line">    std::condition_variable cv;</span><br><span class="line">    <span class="type">uint8_t</span>* nalData;</span><br><span class="line">    <span class="type">size_t</span> nalSize;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Ok, that’s it. Contact me if you have any problems through my GitHub account, you can see it on my homepage.</p>
<h4 id="3-RTSP-Client-Receive-RTSP-stream-data-in-H-264-format-and-re-encode-it-into-H-265"><a href="#3-RTSP-Client-Receive-RTSP-stream-data-in-H-264-format-and-re-encode-it-into-H-265" class="headerlink" title="3. RTSP Client: Receive RTSP stream data in H.264 format and re-encode it into H.265"></a>3. RTSP Client: Receive RTSP stream data in H.264 format and re-encode it into H.265</h4><p>First of all, we need to create an RTSP Client using live555. Once the server is open, we can receive packets in H264 format. Here is an example demonstrating how to receive them and save them as a .h264 file. In addition, I also converted them into H265 format and save them as a .h265 file. Here is the structure of this program. I’ve pushed this publicly on my Github, and here is the link. </p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0hleGxvdmUyL3J0c3BDbGllbnQ=">https://github.com/Hexlove2/rtspClient</span></p>
<img data-src="https://raw.githubusercontent.com/Hexlove2/images1/main/images/Screenshot%202024-10-18%20at%203.57.52%E2%80%AFPM.png" width="500"/>

<p>And here is the code:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Data: 2024/10/14</span></span><br><span class="line"><span class="comment">Sunday Myers</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// C++</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;condition_variable&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// live555</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;BasicUsageEnvironment.hh&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;liveMedia.hh&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ffmpeg</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;libavcodec/avcodec.h&quot;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> maxFrame 50</span></span><br><span class="line"><span class="comment">// client-&gt;&gt;server: DESCRIBE</span></span><br><span class="line"><span class="comment">// server-&gt;&gt;client: 200 OK (SDP)</span></span><br><span class="line"><span class="comment">// client-&gt;&gt;server: SETUP</span></span><br><span class="line"><span class="comment">// server-&gt;&gt;client: 200 OK</span></span><br><span class="line"><span class="comment">// client-&gt;&gt;server: PLAY</span></span><br><span class="line"><span class="comment">// server-&gt;&gt;client: RTP/ client-&gt;&gt;server: TERADOWN</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FrameData</span> &#123;</span><br><span class="line">  <span class="type">int</span> width;</span><br><span class="line">  <span class="type">int</span> height;</span><br><span class="line">  AVPixelFormat format;</span><br><span class="line">  <span class="type">int</span> FPS;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">std::queue&lt;std::pair&lt;<span class="type">uint8_t</span> *, <span class="type">int</span>&gt;&gt; queue264;</span><br><span class="line">std::queue&lt;AVFrame *&gt; queueFrame;</span><br><span class="line">std::queue&lt;std::pair&lt;<span class="type">uint8_t</span> *, <span class="type">int</span>&gt;&gt; queue265;</span><br><span class="line"></span><br><span class="line">std::mutex mutex1;</span><br><span class="line">std::mutex mutex2;</span><br><span class="line">std::mutex mutex3;</span><br><span class="line">std::mutex m_set;</span><br><span class="line"></span><br><span class="line">std::condition_variable cv1;</span><br><span class="line">std::condition_variable cv2;</span><br><span class="line">std::condition_variable cv3;</span><br><span class="line">std::condition_variable cv_set;</span><br><span class="line"></span><br><span class="line">Boolean is_run1;</span><br><span class="line">Boolean is_run2;</span><br><span class="line">Boolean is_run3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FrameData</span> fd;</span><br><span class="line"><span class="type">int</span> count264;</span><br><span class="line">std::ostringstream oss;</span><br><span class="line">Boolean set;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">continueAfterDESCRIBE</span><span class="params">(RTSPClient *rtspClient, <span class="type">int</span> resultCode,</span></span></span><br><span class="line"><span class="params"><span class="function">                           <span class="type">char</span> *resultString)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">continueAfterSETUP</span><span class="params">(RTSPClient *rtspClient, <span class="type">int</span> resultCode,</span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="type">char</span> *resultString)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">continueAfterPLAY</span><span class="params">(RTSPClient *rtspClient, <span class="type">int</span> resultCode,</span></span></span><br><span class="line"><span class="params"><span class="function">                       <span class="type">char</span> *resultString)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">subsessionAfterPlaying</span><span class="params">(<span class="type">void</span> *clientData)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">subsessionByeHandler</span><span class="params">(<span class="type">void</span> *clientData, <span class="type">char</span> <span class="type">const</span> *reason)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">streamTimerHandler</span><span class="params">(<span class="type">void</span> *clientData)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">openURL</span><span class="params">(UsageEnvironment &amp;env, <span class="type">char</span> <span class="type">const</span> *progName, <span class="type">char</span> <span class="type">const</span> *rtspURL)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setupNextSubsession</span><span class="params">(RTSPClient *rtspClient)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">shutdownStream</span><span class="params">(RTSPClient *rtspClient, <span class="type">int</span> exitCode = <span class="number">1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">thread_decode</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">thread_codec</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">thread_save</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">UsageEnvironment &amp;<span class="keyword">operator</span>&lt;&lt;(UsageEnvironment &amp;env,</span><br><span class="line">                             <span class="type">const</span> RTSPClient &amp;rtspClient) &#123;</span><br><span class="line">  <span class="keyword">return</span> env &lt;&lt; <span class="string">&quot;[URL:\&quot;&quot;</span> &lt;&lt; rtspClient.<span class="built_in">url</span>() &lt;&lt; <span class="string">&quot;\&quot;];&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">UsageEnvironment &amp;<span class="keyword">operator</span>&lt;&lt;(UsageEnvironment &amp;env,</span><br><span class="line">                             <span class="type">const</span> MediaSubsession &amp;subsession) &#123;</span><br><span class="line">  <span class="keyword">return</span> env &lt;&lt; subsession.<span class="built_in">mediumName</span>() &lt;&lt; <span class="string">&quot;/&quot;</span> &lt;&lt; subsession.<span class="built_in">codecName</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">usage</span><span class="params">(UsageEnvironment &amp;env, <span class="type">char</span> <span class="type">const</span> *progName)</span> </span>&#123;</span><br><span class="line">  env &lt;&lt; <span class="string">&quot;Usage: &quot;</span> &lt;&lt; progName &lt;&lt; <span class="string">&quot;&lt;rtsp-url-1&gt;...&lt;rtsp-url-N \n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Loop exit if this variable change</span></span><br><span class="line"><span class="type">char</span> eventLoopWatchVariable = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StreamClientState</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">StreamClientState</span>();</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">StreamClientState</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// Through iter, the client can sequentially access each subsession and</span></span><br><span class="line">  <span class="comment">// perform opeartions like SETUP, PLAY.</span></span><br><span class="line">  MediaSubsessionIterator *iter;</span><br><span class="line">  MediaSession *session;</span><br><span class="line">  MediaSubsession *subsession;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// You can use streamTimerTask to set and cancle timer tasks</span></span><br><span class="line">  TaskToken streamTimerTask;</span><br><span class="line">  <span class="type">double</span> duration;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">  TaskScheduler *scheduler = BasicTaskScheduler::<span class="built_in">createNew</span>();</span><br><span class="line">  UsageEnvironment *env = BasicUsageEnvironment::<span class="built_in">createNew</span>(*scheduler);</span><br><span class="line"></span><br><span class="line">  count264 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Get current time</span></span><br><span class="line">  <span class="keyword">auto</span> now = std::chrono::system_clock::<span class="built_in">now</span>();</span><br><span class="line">  std::<span class="type">time_t</span> currentTime = std::chrono::system_clock::<span class="built_in">to_time_t</span>(now);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Use stringstream to format the time into a string</span></span><br><span class="line">  oss &lt;&lt; std::<span class="built_in">put_time</span>(std::<span class="built_in">localtime</span>(&amp;currentTime), <span class="string">&quot;%H:%M&quot;</span>);  </span><br><span class="line"></span><br><span class="line">  is_run1 = <span class="literal">true</span>;</span><br><span class="line">  <span class="function">std::thread <span class="title">decode</span><span class="params">(thread_decode)</span></span>;</span><br><span class="line">  decode.<span class="built_in">detach</span>();</span><br><span class="line"></span><br><span class="line">  is_run2 = <span class="literal">true</span>;</span><br><span class="line">  <span class="function">std::thread <span class="title">encode</span><span class="params">(thread_codec)</span></span>;</span><br><span class="line">  encode.<span class="built_in">detach</span>();</span><br><span class="line"></span><br><span class="line">  is_run3 = <span class="literal">true</span>;</span><br><span class="line">  <span class="function">std::thread <span class="title">save</span><span class="params">(thread_save)</span></span>;</span><br><span class="line">  save.<span class="built_in">detach</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (argc &lt; <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">usage</span>(*env, argv[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Connect to every server</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= argc - <span class="number">1</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">openURL</span>(*env, argv[<span class="number">0</span>], argv[i]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  env-&gt;<span class="built_in">taskScheduler</span>().<span class="built_in">doEventLoop</span>(&amp;eventLoopWatchVariable);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ourRTSPClient</span> : <span class="keyword">public</span> RTSPClient &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">static</span> ourRTSPClient *<span class="title">createNew</span><span class="params">(UsageEnvironment &amp;env, <span class="type">char</span> <span class="type">const</span> *rtspURL,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  <span class="type">int</span> verbosityLevel = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  <span class="type">char</span> <span class="type">const</span> *applicationName = <span class="literal">NULL</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  portNumBits tunnelOverHTTPPortNum = <span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  <span class="built_in">ourRTSPClient</span>(UsageEnvironment &amp;env, <span class="type">char</span> <span class="type">const</span> *rtspURL, <span class="type">int</span> verbosityLevel,</span><br><span class="line">                <span class="type">char</span> <span class="type">const</span> *applicationName, portNumBits tunnelOverHTTPPortNum);</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">ourRTSPClient</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  StreamClientState scs;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DummySink</span> : <span class="keyword">public</span> MediaSink &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">static</span> DummySink *<span class="title">createNew</span><span class="params">(UsageEnvironment &amp;env,</span></span></span><br><span class="line"><span class="params"><span class="function">                              MediaSubsession &amp;subsession,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">char</span> <span class="type">const</span> *streamId = <span class="literal">NULL</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="built_in">DummySink</span>(UsageEnvironment &amp;env, MediaSubsession &amp;subsession,</span><br><span class="line">            <span class="type">char</span> <span class="type">const</span> *streamId);</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">DummySink</span>();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">afterGettingFrame</span><span class="params">(<span class="type">void</span> *clientData, <span class="type">unsigned</span> frameSize,</span></span></span><br><span class="line"><span class="params"><span class="function">                                <span class="type">unsigned</span> numTruncatedBytes,</span></span></span><br><span class="line"><span class="params"><span class="function">                                <span class="keyword">struct</span> timeval presentationTime,</span></span></span><br><span class="line"><span class="params"><span class="function">                                <span class="type">unsigned</span> durationInMicroseconds)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">afterGettingFrame</span><span class="params">(<span class="type">unsigned</span> frameSize, <span class="type">unsigned</span> numTruncatedBytes,</span></span></span><br><span class="line"><span class="params"><span class="function">                         <span class="keyword">struct</span> timeval presentationTime,</span></span></span><br><span class="line"><span class="params"><span class="function">                         <span class="type">unsigned</span> durationInMicroseconds)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> Boolean <span class="title">continuePlaying</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">u_int8_t</span> *fReceiveBuffer;</span><br><span class="line">  MediaSubsession &amp;fSubsession;</span><br><span class="line">  <span class="type">char</span> *fStreamId;</span><br><span class="line">  FILE *fOutputFile;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTSP_CLIENT_VERBOSITY_LEVEL 1</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> rtspClientCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">openURL</span><span class="params">(UsageEnvironment &amp;env, <span class="type">char</span> <span class="type">const</span> *progName, <span class="type">char</span> <span class="type">const</span> *rtspURL)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  RTSPClient *rtspClient = ourRTSPClient::<span class="built_in">createNew</span>(</span><br><span class="line">      env, rtspURL, RTSP_CLIENT_VERBOSITY_LEVEL, progName);</span><br><span class="line">  <span class="keyword">if</span> (rtspClient == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    env &lt;&lt; <span class="string">&quot;Failed to create a RTSP client for URL \&quot;&quot;</span> &lt;&lt; rtspURL</span><br><span class="line">        &lt;&lt; <span class="string">&quot;\&quot;:&quot;</span> &lt;&lt; env.<span class="built_in">getResultMsg</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ++rtspClientCount;</span><br><span class="line">  rtspClient-&gt;<span class="built_in">sendDescribeCommand</span>(continueAfterDESCRIBE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// It&#x27;s a callback function that get triggered when the DESCRIBE response is</span></span><br><span class="line"><span class="comment">// received from the server The DESCRIBE command is used to request a</span></span><br><span class="line"><span class="comment">// description of the media stream in SDP format</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">continueAfterDESCRIBE</span><span class="params">(RTSPClient *rtspClient, <span class="type">int</span> resultCode,</span></span></span><br><span class="line"><span class="params"><span class="function">                           <span class="type">char</span> *resultString)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    UsageEnvironment &amp;env = rtspClient-&gt;<span class="built_in">envir</span>();</span><br><span class="line">    StreamClientState &amp;scs = ((ourRTSPClient *)rtspClient)-&gt;scs;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (resultCode != <span class="number">0</span>) &#123;</span><br><span class="line">      env &lt;&lt; *rtspClient &lt;&lt; <span class="string">&quot;Failed to get a SDP description: &quot;</span> &lt;&lt; resultString</span><br><span class="line">          &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">      <span class="keyword">delete</span>[] resultString;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> *<span class="type">const</span> sdpDescription = resultString;</span><br><span class="line">    env &lt;&lt; *rtspClient &lt;&lt; <span class="string">&quot;Got a SDP description:\n&quot;</span> &lt;&lt; sdpDescription &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    scs.session = MediaSession::<span class="built_in">createNew</span>(env, sdpDescription);</span><br><span class="line">    <span class="keyword">delete</span>[] sdpDescription;</span><br><span class="line">    <span class="keyword">if</span> (scs.session == <span class="literal">NULL</span>) &#123;</span><br><span class="line">      env &lt;&lt; *rtspClient</span><br><span class="line">          &lt;&lt; <span class="string">&quot;Failed to create a mediasession object from the SDP description&quot;</span></span><br><span class="line">          &lt;&lt; env.<span class="built_in">getResultMsg</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!scs.session-&gt;<span class="built_in">hasSubsessions</span>()) &#123;</span><br><span class="line">      env &lt;&lt; *rtspClient &lt;&lt; <span class="string">&quot;This session has no media subsessions \n&quot;</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Then, create and set up our data source objects for the session. We do</span></span><br><span class="line">    <span class="comment">// this by iterating over the session&#x27;s subsessions. calling</span></span><br><span class="line">    <span class="comment">// &quot;MediaSubsession::initiate()&quot;, and then sending a RTSP &quot;SETUP&quot; command,</span></span><br><span class="line">    <span class="comment">// on each one (Each &#x27;subsession&#x27; will have its own data source)</span></span><br><span class="line">    scs.iter = <span class="keyword">new</span> <span class="built_in">MediaSubsessionIterator</span>(*scs.session);</span><br><span class="line">    <span class="built_in">setupNextSubsession</span>(rtspClient);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SUCESS</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">while</span> (<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Unknown and Unrecoverable ERROR occured with this stream</span></span><br><span class="line">  <span class="built_in">shutdownStream</span>(rtspClient);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// By default, we request that the server stream its data using RTP/UDP.</span></span><br><span class="line"><span class="comment">// If, instead, you want to request that the server stream via RTP over TCP,</span></span><br><span class="line"><span class="comment">// changing the following to TRUE. Ensure that the server you wanna connect</span></span><br><span class="line"><span class="comment">// supports RTP/TCP, Otherwise, the RTSP server will most likely reject the</span></span><br><span class="line"><span class="comment">// request during the RTSP SETUP phase.</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> REQUEST_STREAM_OVER_TCP False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// its primary goal is to iterate through all media subsessions within an RTSP</span></span><br><span class="line"><span class="comment">// mediasession, initiate each subsession, and send an RTSP SETUP command for</span></span><br><span class="line"><span class="comment">// each one. After all subsessions are set up, it finally sends a PLAY command</span></span><br><span class="line"><span class="comment">// to start streaming.</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setupNextSubsession</span><span class="params">(RTSPClient *rtspClient)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Alias</span></span><br><span class="line">  UsageEnvironment &amp;env = rtspClient-&gt;<span class="built_in">envir</span>();</span><br><span class="line">  StreamClientState &amp;scs = ((ourRTSPClient *)rtspClient)-&gt;scs;</span><br><span class="line"></span><br><span class="line">  scs.subsession = scs.iter-&gt;<span class="built_in">next</span>();</span><br><span class="line">  <span class="keyword">if</span> (scs.subsession != <span class="literal">NULL</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!scs.subsession-&gt;<span class="built_in">initiate</span>()) &#123;</span><br><span class="line">      env &lt;&lt; *rtspClient &lt;&lt; <span class="string">&quot;Failed to initiate the\&quot;&quot;</span> &lt;&lt; *scs.subsession</span><br><span class="line">          &lt;&lt; <span class="string">&quot;\&quot; subsession: &quot;</span> &lt;&lt; env.<span class="built_in">getResultMsg</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">      <span class="built_in">setupNextSubsession</span>(</span><br><span class="line">          rtspClient); <span class="comment">// give up on this subsession; go to the next one</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      env &lt;&lt; *rtspClient &lt;&lt; <span class="string">&quot;Initiated the \&quot;&quot;</span> &lt;&lt; *scs.subsession</span><br><span class="line">          &lt;&lt; <span class="string">&quot;\&quot; subsession (&quot;</span>;</span><br><span class="line">      <span class="keyword">if</span> (scs.subsession-&gt;<span class="built_in">rtcpIsMuxed</span>()) &#123;</span><br><span class="line">        env &lt;&lt; <span class="string">&quot;client port &quot;</span> &lt;&lt; scs.subsession-&gt;<span class="built_in">clientPortNum</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        env &lt;&lt; <span class="string">&quot;client ports &quot;</span> &lt;&lt; scs.subsession-&gt;<span class="built_in">clientPortNum</span>() &lt;&lt; <span class="string">&quot;-&quot;</span></span><br><span class="line">            &lt;&lt; scs.subsession-&gt;<span class="built_in">clientPortNum</span>() + <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      env &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Continue setting up this subsession, by sending a &quot;SETUP&quot; command;</span></span><br><span class="line">      rtspClient-&gt;<span class="built_in">sendSetupCommand</span>(*scs.subsession, continueAfterSETUP, False,</span><br><span class="line">                                   REQUEST_STREAM_OVER_TCP);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// We&#x27;ve finished all of the subsession. Now, send a RTSP &quot;PLAY&quot; command to</span></span><br><span class="line">  <span class="comment">// start streaming:</span></span><br><span class="line">  <span class="keyword">if</span> (scs.session-&gt;<span class="built_in">absStartTime</span>() != <span class="literal">NULL</span>) &#123;</span><br><span class="line">    <span class="comment">// Special case: The stream is indexed by &#x27;absolute time&#x27;, so send a</span></span><br><span class="line">    <span class="comment">// appropriate &quot;PLAY&quot; command</span></span><br><span class="line">    rtspClient-&gt;<span class="built_in">sendPlayCommand</span>(*scs.session, continueAfterPLAY,</span><br><span class="line">                                scs.session-&gt;<span class="built_in">absStartTime</span>(),</span><br><span class="line">                                scs.session-&gt;<span class="built_in">absEndTime</span>());</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    scs.duration = scs.session-&gt;<span class="built_in">playEndTime</span>() - scs.session-&gt;<span class="built_in">playStartTime</span>();</span><br><span class="line">    rtspClient-&gt;<span class="built_in">sendPlayCommand</span>(*scs.session, continueAfterPLAY);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Callback function</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">continueAfterSETUP</span><span class="params">(RTSPClient *rtspClient, <span class="type">int</span> resultCode,</span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="type">char</span> *resultString)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// Alias</span></span><br><span class="line">    UsageEnvironment &amp;env = rtspClient-&gt;<span class="built_in">envir</span>();</span><br><span class="line">    StreamClientState &amp;scs = ((ourRTSPClient *)rtspClient)-&gt;scs;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (resultCode != <span class="number">0</span>) &#123;</span><br><span class="line">      env &lt;&lt; *rtspClient &lt;&lt; <span class="string">&quot;Failed to set up the \&quot;&quot;</span> &lt;&lt; *scs.subsession</span><br><span class="line">          &lt;&lt; <span class="string">&quot;\&quot; subsession: &quot;</span> &lt;&lt; resultString &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    env &lt;&lt; *rtspClient &lt;&lt; <span class="string">&quot;Set up the \&quot;&quot;</span> &lt;&lt; *scs.subsession</span><br><span class="line">        &lt;&lt; <span class="string">&quot;\&quot; subsession(&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (scs.subsession-&gt;<span class="built_in">rtcpIsMuxed</span>()) &#123;</span><br><span class="line">      env &lt;&lt; <span class="string">&quot;Client port &quot;</span> &lt;&lt; scs.subsession-&gt;<span class="built_in">clientPortNum</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      env &lt;&lt; <span class="string">&quot;Client ports &quot;</span> &lt;&lt; scs.subsession-&gt;<span class="built_in">clientPortNum</span>() &lt;&lt; <span class="string">&quot;-&quot;</span></span><br><span class="line">          &lt;&lt; scs.subsession-&gt;<span class="built_in">clientPortNum</span>() + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    env &lt;&lt; <span class="string">&quot;)\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Having successfully setup the subsession, create a data sink for it, and</span></span><br><span class="line">    <span class="comment">// call &quot;startPlaying()&quot; on it. (This will prepare the data sink to receive</span></span><br><span class="line">    <span class="comment">// data; the actual flow from the client won&#x27;t start happening untill later</span></span><br><span class="line">    <span class="comment">// after we&#x27;ve sent an RTSP &quot;PLAY&quot; command.)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Perhaps use your own custom &quot;MediaSink&quot; subclass instead</span></span><br><span class="line">    scs.subsession-&gt;sink =</span><br><span class="line">        DummySink::<span class="built_in">createNew</span>(env, *scs.subsession, rtspClient-&gt;<span class="built_in">url</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (scs.subsession-&gt;sink == <span class="literal">NULL</span>) &#123;</span><br><span class="line">      env &lt;&lt; *rtspClient &lt;&lt; <span class="string">&quot;Failed to create a data sink for the \&quot;&quot;</span></span><br><span class="line">          &lt;&lt; *scs.subsession &lt;&lt; <span class="string">&quot;\&quot; subsession: &quot;</span> &lt;&lt; env.<span class="built_in">getResultMsg</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    env &lt;&lt; *rtspClient &lt;&lt; <span class="string">&quot;Create a data sink for the \&quot;&quot;</span> &lt;&lt; *scs.subsession</span><br><span class="line">        &lt;&lt; <span class="string">&quot;\&quot; subsession\n&quot;</span>;</span><br><span class="line">    scs.subsession-&gt;miscPtr = rtspClient;</span><br><span class="line">    scs.subsession-&gt;sink-&gt;<span class="built_in">startPlaying</span>(*(scs.subsession-&gt;<span class="built_in">readSource</span>()),</span><br><span class="line">                                       subsessionAfterPlaying, scs.subsession);</span><br><span class="line">    <span class="comment">// Also set a handler to be called if a RTSP &quot;BYE&quot; arrives for this</span></span><br><span class="line">    <span class="comment">// subsession</span></span><br><span class="line">    <span class="keyword">if</span> (scs.subsession-&gt;<span class="built_in">rtcpInstance</span>() != <span class="literal">NULL</span>) &#123;</span><br><span class="line">      scs.subsession-&gt;<span class="built_in">rtcpInstance</span>()-&gt;<span class="built_in">setByeWithReasonHandler</span>(</span><br><span class="line">          subsessionByeHandler, scs.subsession);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">while</span> (<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">delete</span>[] resultString;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set up the next subsession, if any:</span></span><br><span class="line">  <span class="built_in">setupNextSubsession</span>(rtspClient);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A callback function that is triggered after the RTSP client sends a PLAY</span></span><br><span class="line"><span class="comment">// command and receives a response from the RTSP server</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">continueAfterPLAY</span><span class="params">(RTSPClient *rtspClient, <span class="type">int</span> resultCode,</span></span></span><br><span class="line"><span class="params"><span class="function">                       <span class="type">char</span> *resultString)</span> </span>&#123;</span><br><span class="line">  Boolean success = False;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// Alias</span></span><br><span class="line">    UsageEnvironment &amp;env = rtspClient-&gt;<span class="built_in">envir</span>();</span><br><span class="line">    StreamClientState &amp;scs = ((ourRTSPClient *)rtspClient)-&gt;scs;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (resultCode != <span class="number">0</span>) &#123;</span><br><span class="line">      env &lt;&lt; *rtspClient &lt;&lt; <span class="string">&quot;Failed to start playing session: &quot;</span> &lt;&lt; resultString</span><br><span class="line">          &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set a timer to be handled at the end of the stream&#x27;s expected duration</span></span><br><span class="line">    <span class="comment">// (if the stream does not already signal its end using an RTSP &quot;BYE&quot;). This</span></span><br><span class="line">    <span class="comment">// is optional. If, instead, you want to keep the stream active - e.g., so</span></span><br><span class="line">    <span class="comment">// you can later &#x27;seek&#x27; back within it and do another RTSP &quot;PLAY&quot; - then you</span></span><br><span class="line">    <span class="comment">// can omit this code. (Alternatively, if you don&#x27;t want to receive the</span></span><br><span class="line">    <span class="comment">// entire stream, you could set this timer for some shorter value) This</span></span><br><span class="line">    <span class="comment">// ensures that the client handles the stream&#x27;s end properly</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Btw, The duration won&#x27;t be set if it&#x27;s a live stream</span></span><br><span class="line">    <span class="keyword">if</span> (scs.duration &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="type">unsigned</span> <span class="type">const</span> delaySlop =</span><br><span class="line">          <span class="number">2</span>; <span class="comment">// number of seconds extra to delay, after the stream&#x27;s expected</span></span><br><span class="line">             <span class="comment">// duration. (This is optional)</span></span><br><span class="line">      scs.duration += delaySlop;</span><br><span class="line">      <span class="type">unsigned</span> uSecsToDelay =</span><br><span class="line">          (<span class="type">unsigned</span>)(scs.duration * <span class="number">1000000</span>); <span class="comment">// Convert second into microsecond</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// This schedules a task to be executed after the stream&#x27;s duration has</span></span><br><span class="line">      <span class="comment">// passed. The task scheduled here is stream streamTimerHandler, which is</span></span><br><span class="line">      <span class="comment">// responsible for handling the stream&#x27;s completion or timeout.</span></span><br><span class="line">      scs.streamTimerTask = env.<span class="built_in">taskScheduler</span>().<span class="built_in">scheduleDelayedTask</span>(</span><br><span class="line">          uSecsToDelay, (TaskFunc *)streamTimerHandler, rtspClient);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    env &lt;&lt; *rtspClient &lt;&lt; <span class="string">&quot;Started playing session &quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (scs.duration &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      env &lt;&lt; <span class="string">&quot; (for up to&quot;</span> &lt;&lt; scs.duration &lt;&lt; <span class="string">&quot; seconds)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    env &lt;&lt; <span class="string">&quot;...\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    success = True;</span><br><span class="line">  &#125; <span class="keyword">while</span> (<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">delete</span>[] resultString;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">    <span class="built_in">shutdownStream</span>(rtspClient);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Implementation of the other event handlers</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">subsessionAfterPlaying</span><span class="params">(<span class="type">void</span> *clientData)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Alias</span></span><br><span class="line">  MediaSubsession *subsession = (MediaSubsession *)clientData;</span><br><span class="line">  RTSPClient *rtspClient = (RTSPClient *)(subsession-&gt;miscPtr);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Begin by closing the subsession&#x27;s stream;</span></span><br><span class="line">  Medium::<span class="built_in">close</span>(subsession-&gt;sink);</span><br><span class="line">  subsession-&gt;sink = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Next, check whether all subsessions&#x27; streams have now been closed.</span></span><br><span class="line">  MediaSession &amp;session = subsession-&gt;<span class="built_in">parentSession</span>();</span><br><span class="line">  <span class="function">MediaSubsessionIterator <span class="title">iter</span><span class="params">(session)</span></span>;</span><br><span class="line">  <span class="keyword">while</span> ((subsession = iter.<span class="built_in">next</span>()) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">    <span class="comment">// This subsession is still active</span></span><br><span class="line">    <span class="keyword">if</span> (subsession-&gt;sink != <span class="literal">NULL</span>)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Now, all the subsessions&#x27; streams have been closed, so shutdown the client</span></span><br><span class="line">  <span class="built_in">shutdownStream</span>(rtspClient);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">subsessionByeHandler</span><span class="params">(<span class="type">void</span> *clientData, <span class="type">char</span> <span class="type">const</span> *reason)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Alias</span></span><br><span class="line">  MediaSubsession *subsession = (MediaSubsession *)clientData;</span><br><span class="line">  RTSPClient *rtspClient = (RTSPClient *)subsession-&gt;miscPtr;</span><br><span class="line">  UsageEnvironment &amp;env = rtspClient-&gt;<span class="built_in">envir</span>();</span><br><span class="line"></span><br><span class="line">  env &lt;&lt; *rtspClient &lt;&lt; <span class="string">&quot;Received RTCP \&quot;BYE\&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (reason != <span class="literal">NULL</span>) &#123;</span><br><span class="line">    env &lt;&lt; <span class="string">&quot; (reason:\&quot;&quot;</span> &lt;&lt; reason &lt;&lt; <span class="string">&quot;\&quot;)&quot;</span>;</span><br><span class="line">    <span class="keyword">delete</span>[] (<span class="type">char</span> *)reason;</span><br><span class="line">  &#125;</span><br><span class="line">  env &lt;&lt; <span class="string">&quot; on \&quot;&quot;</span> &lt;&lt; *subsession &lt;&lt; <span class="string">&quot;\&quot; subsession \n&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Now act as if the subsession had closed</span></span><br><span class="line">  <span class="built_in">subsessionAfterPlaying</span>(subsession);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">streamTimerHandler</span><span class="params">(<span class="type">void</span> *clientData)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Alias</span></span><br><span class="line">  ourRTSPClient *rtspClient = (ourRTSPClient *)clientData;</span><br><span class="line">  StreamClientState &amp;scs = rtspClient-&gt;scs;</span><br><span class="line"></span><br><span class="line">  scs.streamTimerTask = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Shut down the stream;</span></span><br><span class="line">  <span class="built_in">shutdownStream</span>(rtspClient);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">shutdownStream</span><span class="params">(RTSPClient *rtspClient, <span class="type">int</span> exitCode)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Alias</span></span><br><span class="line">  UsageEnvironment &amp;env = rtspClient-&gt;<span class="built_in">envir</span>();</span><br><span class="line">  StreamClientState &amp;scs = ((ourRTSPClient *)rtspClient)-&gt;scs;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// First, check whether any subsessions have still to be closed;</span></span><br><span class="line">  <span class="keyword">if</span> (scs.session != <span class="literal">NULL</span>) &#123;</span><br><span class="line">    Boolean someSubsessionsWereActive = False;</span><br><span class="line">    <span class="function">MediaSubsessionIterator <span class="title">iter</span><span class="params">(*scs.session)</span></span>;</span><br><span class="line">    MediaSubsession *subsession;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ((subsession = iter.<span class="built_in">next</span>()) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (subsession-&gt;sink != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        Medium::<span class="built_in">close</span>(subsession-&gt;sink);</span><br><span class="line">        subsession-&gt;sink = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// In case the server sends a RTCP &quot;BYE&quot; while handling &quot;TEARDOWN&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (subsession-&gt;<span class="built_in">rtcpInstance</span>() != <span class="literal">NULL</span>) &#123;</span><br><span class="line">          subsession-&gt;<span class="built_in">rtcpInstance</span>()-&gt;<span class="built_in">setByeHandler</span>(<span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        someSubsessionsWereActive = True;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (someSubsessionsWereActive) &#123;</span><br><span class="line">      <span class="comment">// Send an RTSP &quot;TEARDOWN&quot; command to tell the server to shutdown the</span></span><br><span class="line">      <span class="comment">// stream. Don&#x27;t bother handling the response to the &quot;TEARDOWN&quot;.</span></span><br><span class="line">      rtspClient-&gt;<span class="built_in">sendTeardownCommand</span>(*scs.session, <span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  env &lt;&lt; *rtspClient &lt;&lt; <span class="string">&quot;Closing the stream. \n&quot;</span>;</span><br><span class="line">  Medium::<span class="built_in">close</span>(rtspClient);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (--rtspClientCount == <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">exit</span>(exitCode);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Implementation of &quot;ourRTSPClient&quot;:</span></span><br><span class="line"></span><br><span class="line"><span class="function">ourRTSPClient *<span class="title">ourRTSPClient::createNew</span><span class="params">(UsageEnvironment &amp;env,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        <span class="type">char</span> <span class="type">const</span> *rtspURL, <span class="type">int</span> verbosityLevel,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        <span class="type">char</span> <span class="type">const</span> *applicationName,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        portNumBits tunnelOverHTTPPortNum)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">ourRTSPClient</span>(env, rtspURL, verbosityLevel, applicationName,</span><br><span class="line">                           tunnelOverHTTPPortNum);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ourRTSPClient::<span class="built_in">ourRTSPClient</span>(UsageEnvironment &amp;env, <span class="type">char</span> <span class="type">const</span> *rtspURL,</span><br><span class="line">                             <span class="type">int</span> verbosityLevel, <span class="type">char</span> <span class="type">const</span> *applicationName,</span><br><span class="line">                             portNumBits tunnelOverHTTPPortNum)</span><br><span class="line">    : <span class="built_in">RTSPClient</span>(env, rtspURL, verbosityLevel, applicationName,</span><br><span class="line">                 tunnelOverHTTPPortNum, <span class="number">-1</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">ourRTSPClient::~<span class="built_in">ourRTSPClient</span>() &#123;</span><br><span class="line">  is_run1 = False;</span><br><span class="line">  is_run2 = False;</span><br><span class="line">  is_run3 = False;</span><br><span class="line">  cv1.<span class="built_in">notify_all</span>();</span><br><span class="line">  cv2.<span class="built_in">notify_all</span>();</span><br><span class="line">  cv3.<span class="built_in">notify_all</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Implementation of &quot;StreamClientState&quot; :</span></span><br><span class="line"></span><br><span class="line">StreamClientState::<span class="built_in">StreamClientState</span>()</span><br><span class="line">    : <span class="built_in">iter</span>(<span class="literal">NULL</span>), <span class="built_in">session</span>(<span class="literal">NULL</span>), <span class="built_in">subsession</span>(<span class="literal">NULL</span>), <span class="built_in">streamTimerTask</span>(<span class="literal">NULL</span>),</span><br><span class="line">      <span class="built_in">duration</span>(<span class="number">0.0</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">StreamClientState::~<span class="built_in">StreamClientState</span>() &#123;</span><br><span class="line">  <span class="keyword">delete</span> iter;</span><br><span class="line">  <span class="keyword">if</span> (session != <span class="literal">NULL</span>) &#123;</span><br><span class="line">    <span class="comment">// We also need to delete &quot;session&quot;, and unschedule &quot;steamTimerTask&quot; (if</span></span><br><span class="line">    <span class="comment">// set) Alias</span></span><br><span class="line">    UsageEnvironment &amp;env = session-&gt;<span class="built_in">envir</span>();</span><br><span class="line"></span><br><span class="line">    env.<span class="built_in">taskScheduler</span>().<span class="built_in">unscheduleDelayedTask</span>(streamTimerTask);</span><br><span class="line">    Medium::<span class="built_in">close</span>(session);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Implementation of &quot;DummySink&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Even though we&#x27;re not going to be doing anything with the incoming data, we</span></span><br><span class="line"><span class="comment">// still need to receive it. Define the size of the buffer that we&#x27;ll use:</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DUMMY_SINK_RECEIVE_BUFFER_SIZE 1000000</span></span><br><span class="line"></span><br><span class="line"><span class="function">DummySink *<span class="title">DummySink::createNew</span><span class="params">(UsageEnvironment &amp;env,</span></span></span><br><span class="line"><span class="params"><span class="function">                                MediaSubsession &amp;subsession,</span></span></span><br><span class="line"><span class="params"><span class="function">                                <span class="type">char</span> <span class="type">const</span> *streamId)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">DummySink</span>(env, subsession, streamId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DummySink::<span class="built_in">DummySink</span>(UsageEnvironment &amp;env, MediaSubsession &amp;subsession,</span><br><span class="line">                     <span class="type">char</span> <span class="type">const</span> *streamId)</span><br><span class="line">    : <span class="built_in">MediaSink</span>(env), <span class="built_in">fSubsession</span>(subsession) &#123;</span><br><span class="line">  fStreamId = <span class="built_in">strDup</span>(streamId);</span><br><span class="line">  fReceiveBuffer = <span class="keyword">new</span> <span class="type">u_int8_t</span>[DUMMY_SINK_RECEIVE_BUFFER_SIZE];</span><br><span class="line"></span><br><span class="line">  std::string fileName = <span class="string">&quot;./save/output_&quot;</span> + oss.<span class="built_in">str</span>() + <span class="string">&quot;.h264&quot;</span>;</span><br><span class="line">  fOutputFile = <span class="built_in">fopen</span>(fileName.<span class="built_in">c_str</span>(), <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DummySink::~<span class="built_in">DummySink</span>() &#123;</span><br><span class="line">  <span class="built_in">fclose</span>(fOutputFile);</span><br><span class="line">  <span class="keyword">delete</span>[] fReceiveBuffer;</span><br><span class="line">  <span class="keyword">delete</span>[] fStreamId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DummySink::afterGettingFrame</span><span class="params">(<span class="type">void</span> *clientData, <span class="type">unsigned</span> frameSize,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  <span class="type">unsigned</span> numTruncatedBytes,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  <span class="keyword">struct</span> timeval presentationTime,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  <span class="type">unsigned</span> durationInMicroseconds)</span> </span>&#123;</span><br><span class="line">  DummySink *sink = (DummySink *)clientData;</span><br><span class="line">  sink-&gt;<span class="built_in">afterGettingFrame</span>(frameSize, numTruncatedBytes, presentationTime,</span><br><span class="line">                          durationInMicroseconds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// If you don&#x27;t wanna see debugging output for each received frame, then comment</span></span><br><span class="line"><span class="comment">// out the following line:</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEBUG_PRINT_EACH_RECEIVED_FRAME 1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DummySink::afterGettingFrame</span><span class="params">(<span class="type">unsigned</span> frameSize,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  <span class="type">unsigned</span> numTruncatedBytes,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  <span class="keyword">struct</span> timeval presentationTime,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  <span class="type">unsigned</span> durationInMicroseconds)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// We&#x27;ve just received a frame of data. (Optionally) print out information</span></span><br><span class="line">  <span class="comment">// about it:</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DEBUG_PRINT_EACH_RECEIVED_FRAME</span></span><br><span class="line">  <span class="keyword">if</span> (fStreamId != <span class="literal">NULL</span>)</span><br><span class="line">    <span class="built_in">envir</span>() &lt;&lt; <span class="string">&quot;Stream \&quot;&quot;</span> &lt;&lt; fStreamId &lt;&lt; <span class="string">&quot;\&quot;;&quot;</span>;</span><br><span class="line">  <span class="built_in">envir</span>() &lt;&lt; fSubsession.<span class="built_in">mediumName</span>() &lt;&lt; <span class="string">&quot;/&quot;</span> &lt;&lt; fSubsession.<span class="built_in">codecName</span>()</span><br><span class="line">          &lt;&lt; <span class="string">&quot;:\tReceived &quot;</span> &lt;&lt; frameSize &lt;&lt; <span class="string">&quot; bytes&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (numTruncatedBytes &gt; <span class="number">0</span>)</span><br><span class="line">    <span class="built_in">envir</span>() &lt;&lt; <span class="string">&quot; (with &quot;</span> &lt;&lt; numTruncatedBytes &lt;&lt; <span class="string">&quot;bytes truncated&quot;</span>;</span><br><span class="line">  <span class="type">char</span> uSecsStr[<span class="number">6</span> + <span class="number">1</span>];</span><br><span class="line">  <span class="built_in">snprintf</span>(uSecsStr, <span class="built_in">sizeof</span>(uSecsStr), <span class="string">&quot;%06u&quot;</span>,</span><br><span class="line">           (<span class="type">unsigned</span>)presentationTime.tv_usec);</span><br><span class="line">  <span class="built_in">envir</span>() &lt;&lt; <span class="string">&quot;.\tPresentation time: &quot;</span> &lt;&lt; (<span class="type">int</span>)presentationTime.tv_sec &lt;&lt; <span class="string">&quot;.&quot;</span></span><br><span class="line">          &lt;&lt; uSecsStr;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fSubsession.<span class="built_in">rtpSource</span>() != <span class="literal">NULL</span> &amp;&amp;</span><br><span class="line">      !fSubsession.<span class="built_in">rtpSource</span>()-&gt;<span class="built_in">hasBeenSynchronizedUsingRTCP</span>()) &#123;</span><br><span class="line">    <span class="built_in">envir</span>() &lt;&lt; <span class="string">&quot;!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DEBUG_PRINT_NPT</span></span><br><span class="line">  <span class="built_in">envir</span>() &lt;&lt; <span class="string">&quot;\tNPT: &quot;</span> &lt;&lt; fSubsession.<span class="built_in">getNormalPlayTime</span>(presentationTime);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  <span class="built_in">envir</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  count264++;</span><br><span class="line">  <span class="keyword">if</span>(count264 &lt;= maxFrame)</span><br><span class="line">    <span class="built_in">fwrite</span>(fReceiveBuffer, <span class="number">1</span>, frameSize, fOutputFile);</span><br><span class="line">  <span class="type">uint8_t</span> *copyData = <span class="keyword">new</span> <span class="type">uint8_t</span>[frameSize];</span><br><span class="line">  <span class="built_in">memmove</span>(copyData, fReceiveBuffer, frameSize);</span><br><span class="line">  <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock1</span><span class="params">(mutex1)</span></span>;</span><br><span class="line">  queue264.<span class="built_in">push</span>(std::<span class="built_in">make_pair</span>(copyData, frameSize));</span><br><span class="line">  cv1.<span class="built_in">notify_one</span>();</span><br><span class="line">  <span class="built_in">continuePlaying</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Boolean <span class="title">DummySink::continuePlaying</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (fSource == <span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> False;</span><br><span class="line"></span><br><span class="line">  fSource-&gt;<span class="built_in">getNextFrame</span>(fReceiveBuffer, DUMMY_SINK_RECEIVE_BUFFER_SIZE,</span><br><span class="line">                        afterGettingFrame, <span class="keyword">this</span>, onSourceClosure, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> True;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">thread_decode</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Initialize the decode environment</span></span><br><span class="line">  <span class="type">int</span> id = <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> result;</span><br><span class="line">  set = True;</span><br><span class="line"></span><br><span class="line">  <span class="type">const</span> AVCodec *codec = <span class="built_in">avcodec_find_decoder</span>(AV_CODEC_ID_H264);</span><br><span class="line">  <span class="keyword">if</span> (!codec) &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;Failed to find the decoder&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  AVCodecContext *ctx = <span class="built_in">avcodec_alloc_context3</span>(codec);</span><br><span class="line">  <span class="keyword">if</span> (!ctx) &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;Failed to allocate video codec context&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">avcodec_open2</span>(ctx, codec, <span class="literal">nullptr</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;Couldn&#x27;t open the codec!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">avcodec_free_context</span>(&amp;ctx);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  AVPacket *pkt = <span class="built_in">av_packet_alloc</span>();</span><br><span class="line"></span><br><span class="line">  <span class="type">uint8_t</span> *data;</span><br><span class="line">  <span class="type">int</span> size;</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock1</span><span class="params">(mutex1)</span></span>;</span><br><span class="line">    cv1.<span class="built_in">wait</span>(lock1, []() &#123; <span class="keyword">return</span> !queue264.<span class="built_in">empty</span>(); &#125;);</span><br><span class="line">    <span class="keyword">if</span> (!is_run1)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">auto</span> nalData = queue264.<span class="built_in">front</span>();</span><br><span class="line">    queue264.<span class="built_in">pop</span>();</span><br><span class="line">    data = nalData.first;</span><br><span class="line">    size = nalData.second;</span><br><span class="line"></span><br><span class="line">    pkt-&gt;data = data;</span><br><span class="line">    pkt-&gt;size = size;</span><br><span class="line"></span><br><span class="line">    result = <span class="built_in">avcodec_send_packet</span>(ctx, pkt);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      std::cerr &lt;&lt; <span class="string">&quot;Error sending packet for decoding&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">      AVFrame *frame = <span class="built_in">av_frame_alloc</span>();</span><br><span class="line">      result = <span class="built_in">avcodec_receive_frame</span>(ctx, frame);</span><br><span class="line">      <span class="keyword">if</span> (result == <span class="built_in">AVERROR</span>(EAGAIN) || result == AVERROR_EOF || result &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">av_frame_free</span>(&amp;frame);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (set) &#123;</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lockS</span><span class="params">(m_set)</span></span>;</span><br><span class="line">        fd.height = frame-&gt;height;</span><br><span class="line">        fd.width = frame-&gt;width;</span><br><span class="line">        fd.format = <span class="built_in">static_cast</span>&lt;AVPixelFormat&gt;(frame-&gt;format);</span><br><span class="line">        set = False;</span><br><span class="line">        cv_set.<span class="built_in">notify_one</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      id++;</span><br><span class="line">      std::cout &lt;&lt; <span class="string">&quot;Decode frame:&quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot; Width: &quot;</span> &lt;&lt; frame-&gt;width</span><br><span class="line">                &lt;&lt; <span class="string">&quot; Height: &quot;</span> &lt;&lt; frame-&gt;height &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">      <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock2</span><span class="params">(mutex2)</span></span>;</span><br><span class="line">      queueFrame.<span class="built_in">push</span>(frame);</span><br><span class="line">      cv2.<span class="built_in">notify_one</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span>[] data;</span><br><span class="line">    data = <span class="literal">nullptr</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">av_packet_free</span>(&amp;pkt);</span><br><span class="line">  <span class="built_in">avcodec_free_context</span>(&amp;ctx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">thread_codec</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> result;</span><br><span class="line">  <span class="type">const</span> AVCodec *codec = <span class="built_in">avcodec_find_encoder</span>(AV_CODEC_ID_HEVC);</span><br><span class="line">  <span class="keyword">if</span> (!codec) &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;Failed to find the encoder!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  AVCodecContext *ctx = <span class="built_in">avcodec_alloc_context3</span>(codec);</span><br><span class="line">  <span class="keyword">if</span> (!ctx) &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;Failed to allocate video codec context!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lockS</span><span class="params">(m_set)</span></span>;</span><br><span class="line">  cv_set.<span class="built_in">wait</span>(lockS, []() &#123; <span class="keyword">return</span> !set; &#125;);</span><br><span class="line">  ctx-&gt;width = fd.width;</span><br><span class="line">  ctx-&gt;height = fd.height;</span><br><span class="line">  ctx-&gt;pix_fmt = fd.format;</span><br><span class="line">  ctx-&gt;time_base.num = <span class="number">1</span>;</span><br><span class="line">  ctx-&gt;time_base.den = <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">avcodec_open2</span>(ctx, codec, <span class="literal">NULL</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;Couldn&#x27;t open codec&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  AVFrame *frame;</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock2</span><span class="params">(mutex2)</span></span>;</span><br><span class="line">    cv2.<span class="built_in">wait</span>(lock2, []() &#123; <span class="keyword">return</span> !queueFrame.<span class="built_in">empty</span>(); &#125;);</span><br><span class="line">    <span class="keyword">if</span> (!is_run2)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    frame = queueFrame.<span class="built_in">front</span>();</span><br><span class="line">    queueFrame.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">avcodec_send_frame</span>(ctx, frame) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      std::cerr &lt;&lt; <span class="string">&quot;Error sending a frame for encoding&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">      AVPacket *pkt = <span class="built_in">av_packet_alloc</span>();</span><br><span class="line">      result = <span class="built_in">avcodec_receive_packet</span>(ctx, pkt);</span><br><span class="line">      <span class="keyword">if</span> (result == <span class="built_in">AVERROR</span>(EAGAIN) || result == AVERROR_EOF || result &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">av_packet_free</span>(&amp;pkt);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">uint8_t</span> *data = <span class="keyword">new</span> <span class="type">uint8_t</span>[pkt-&gt;size];</span><br><span class="line">      <span class="built_in">memmove</span>(data, pkt-&gt;data, pkt-&gt;size);</span><br><span class="line">      <span class="type">int</span> size = pkt-&gt;size;</span><br><span class="line">      <span class="built_in">av_packet_free</span>(&amp;pkt);</span><br><span class="line">      <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock3</span><span class="params">(mutex3)</span></span>;</span><br><span class="line">      queue265.<span class="built_in">push</span>(std::<span class="built_in">make_pair</span>(data, size));</span><br><span class="line">      cv3.<span class="built_in">notify_one</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">av_frame_free</span>(&amp;frame);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">avcodec_free_context</span>(&amp;ctx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">thread_save</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">  FILE *h265;</span><br><span class="line">  std::string fileName = <span class="string">&quot;./save/output_&quot;</span> + oss.<span class="built_in">str</span>() + <span class="string">&quot;.h265&quot;</span>;</span><br><span class="line">  h265 = <span class="built_in">fopen</span>(fileName.<span class="built_in">c_str</span>(), <span class="string">&quot;wb&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock3</span><span class="params">(mutex3)</span></span>;</span><br><span class="line">    cv3.<span class="built_in">wait</span>(lock3, []() &#123; <span class="keyword">return</span> !queue265.<span class="built_in">empty</span>(); &#125;);</span><br><span class="line">    <span class="keyword">if</span> (!is_run3)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">auto</span> data265 = queue265.<span class="built_in">front</span>();</span><br><span class="line">    queue265.<span class="built_in">pop</span>();</span><br><span class="line">    <span class="type">uint8_t</span> *data = data265.first;</span><br><span class="line">    <span class="type">int</span> size = data265.second;</span><br><span class="line">    count++;</span><br><span class="line">    <span class="built_in">fwrite</span>(data, <span class="number">1</span>, size, h265);</span><br><span class="line">    <span class="keyword">if</span>(count == maxFrame) <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">delete</span>[] data;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">fclose</span>(h265);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      <div class="tags">
          <a href="/tags/live555-ffmpeg/" rel="tag"><i class="ic i-tag"></i> live555, ffmpeg</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2024-10-18 17:07:48" itemprop="dateModified" datetime="2024-10-18T17:07:48+09:00">2024-10-18</time>
  </span>
</div>

      
<div class="reward">
  <checkbox><i class="ic i-heartbeat"></i> Donate</checkbox>
  <p>Give me a cup of [coffee]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="Sunday WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="Sunday Alipay">
        <p>Alipay</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt="Sunday PayPal">
        <p>PayPal</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>Post author:  </strong>Sunday <i class="ic i-at"><em>@</em></i>Hex
  </li>
  <li class="link">
    <strong>Post link: </strong>
    <a href="http://hexlove2.github.io/2024/10/11/Notes/live555usage/" title="Live555 Usage(FFmpeg)">http://hexlove2.github.io/2024/10/11/Notes/live555usage/</a>
  </li>
  <li class="license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2024/09/13/Notes/Cmake/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;Hexlove2&#x2F;images1&#x2F;main&#x2F;images2&#x2F;12.jpg" title="Project Building Notes">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> Notes</span>
  <h3>Project Building Notes</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2025/02/18/Projects/httpserver/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;Hexlove2&#x2F;images1&#x2F;main&#x2F;images2&#x2F;9.jpg" title="Http Linux Server">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> Projects</span>
  <h3>Http Linux Server</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Platform-Win10-amp-MacOS15"><span class="toc-number">1.</span> <span class="toc-text">Platform: Win10 &amp; MacOS15</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reference-FFMPEG-LIVE555"><span class="toc-number">2.</span> <span class="toc-text">Reference: FFMPEG, LIVE555</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Source-Code-Download-Link-https-github-com-rgaufman-live555"><span class="toc-number">3.</span> <span class="toc-text">1. Source Code Download Link: https:&#x2F;&#x2F;github.com&#x2F;rgaufman&#x2F;live555</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Build"><span class="toc-number">4.</span> <span class="toc-text">2. Build</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Usages"><span class="toc-number">5.</span> <span class="toc-text">3. Usages</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Push-local-audio-and-video-files%E2%80%99-stream-to-an-RTSP-server"><span class="toc-number">5.1.</span> <span class="toc-text">1. Push local audio and video files’ stream to an RTSP server.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Push-the-camera-stream-to-an-RTSP-server"><span class="toc-number">5.2.</span> <span class="toc-text">2. Push the camera stream to an RTSP server.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-RTSP-Client-Receive-RTSP-stream-data-in-H-264-format-and-re-encode-it-into-H-265"><span class="toc-number">5.3.</span> <span class="toc-text">3. RTSP Client: Receive RTSP stream data in H.264 format and re-encode it into H.265</span></a></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
        <ul>
          <li><a href="/2023/01/09/Notes/Csharp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="bookmark" title="C#初级笔记">C#初级笔记</a></li><li><a href="/2024/02/29/Notes/Socket%20learning/" rel="bookmark" title="TCP/IP Socket Coding">TCP/IP Socket Coding</a></li><li><a href="/2024/07/07/Notes/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="bookmark" title="Interview Questions">Interview Questions</a></li><li><a href="/2024/08/10/Notes/The%20Elements%20of%20Statistical%20Learning/" rel="bookmark" title="Statistical Learning">Statistical Learning</a></li><li><a href="/2024/09/13/Notes/Cmake/" rel="bookmark" title="Project Building Notes">Project Building Notes</a></li><li class="active"><a href="/2024/10/11/Notes/live555usage/" rel="bookmark" title="Live555 Usage(FFmpeg)">Live555 Usage(FFmpeg)</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="Sunday"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">Sunday</p>
  <div class="description" itemprop="description">Looking for freedom of mind</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">20</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">7</span>
        <span class="name">categories</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">12</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0hleGxvdmUy" title="https:&#x2F;&#x2F;github.com&#x2F;Hexlove2"><i class="ic i-github"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTMxMzY0NTk5Ng==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;313645996"><i class="ic i-cloud-music"></i></span>
      <a href="/hexlove@163.com" title="hexlove@163.com" class="item email"><i class="ic i-envelope"></i></a>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>About</a>
  </li>

    
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a>
  </li>

    
  <li class="item">
    <a href="/friends/" rel="section"><i class="ic i-heart"></i>Friends</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-moon"></i>Art</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/paint/" rel="section"><i class="ic i-sun"></i>Paint</a>
  </li>

  </ul>
        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-sakura"></i>Demo</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/HTML/index.html" rel="section"><i class="ic i-flag"></i>Score</a>
  </li>

  </ul>

</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2024/09/13/Notes/Cmake/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2025/02/18/Projects/httpserver/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>Random Posts</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Notes/" title="In Notes">Notes</a>
</div>

    <span><a href="/2024/07/07/Notes/%E9%9D%A2%E8%AF%95%E9%A2%98/" title="Interview Questions">Interview Questions</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Coding/" title="In Coding">Coding</a>
</div>

    <span><a href="/2022/12/05/Coding/Unity+Git/" title="Unity+Git">Unity+Git</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Journey/" title="In Journey">Journey</a>
</div>

    <span><a href="/2022/10/29/Journey/hexo/" title="关于Hexo s显示正常但Hexo d没有更新内容的问题">关于Hexo s显示正常但Hexo d没有更新内容的问题</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Coding/" title="In Coding">Coding</a>
</div>

    <span><a href="/2024/07/22/Coding/PjSip_Usage/" title="Usage of PjSip">Usage of PjSip</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Projects/" title="In Projects">Projects</a>
</div>

    <span><a href="/2025/02/18/Projects/httpserver/" title="Http Linux Server">Http Linux Server</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Notes/" title="In Notes">Notes</a>
</div>

    <span><a href="/2024/02/29/Notes/Socket%20learning/" title="TCP&#x2F;IP Socket Coding">TCP/IP Socket Coding</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/book/" title="In book?">book?</a>
</div>

    <span><a href="/2022/12/11/Template/" title="Name">Name</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Coding/" title="In Coding">Coding</a>
</div>

    <span><a href="/2022/08/31/Coding/Comparison%20Between%20Hue%20and%20red%20subtract%20blue%20channel%20detect/" title="缺陷检测方法对比">缺陷检测方法对比</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Books/" title="In Books">Books</a>
</div>

    <span><a href="/2024/07/11/Books/Good%20girl's%20guide%20to%20murder/" title="A Good Girl&#39;s Guide To Murder">A Good Girl's Guide To Murder</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Coding/" title="In Coding">Coding</a>
</div>

    <span><a href="/2024/09/05/Coding/Imageprocess/" title="Image Processing Algorithm(Raw Data)">Image Processing Algorithm(Raw Data)</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>Recent Comments</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Sunday @ Hex</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2024/10/11/Notes/live555usage/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    copyright: 'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
